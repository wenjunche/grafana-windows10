/*! For license information please see lokiPlugin.898fe9e20a782b4232fe.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{"+2Nz":function(e,t,r){"use strict";r.r(t);var n,a=r("Obii"),o=r("LvDl"),i=r.n(o),u=r("mEZQ"),s=r("lYZG"),c=r("0/uQ"),l=r("F/XL"),f=r("p0ib"),p=r("9Z1F"),m=r("VnD/"),b=r("67Y/"),d=r("15JJ"),h=r("psW0"),v=r("eqT+"),y=r("t8hP"),g=r("m257"),x=r("aCH8"),O=r.n(x),w=r("5kRJ"),j=r("iZOS");!function(e){e.Stream="streams",e.Vector="vector",e.Matrix="matrix"}(n||(n={}));var k=r("kGJw"),E=r.n(k),S=/(?:^|\s){[^{]*}/g;function _(e){var t=(e=e||"").match(S),r=e,n="";return t&&((n=e.replace(S,"").trim())&&-1===n.search(/\|=|\|~|!=|!~/)?r=t[0].trim():n=""),{regexp:n,query:r}}function T(e,t){return"".concat(e||""," ").concat(t||"").trim()}function L(e){var t=_(e);if(t.regexp)return[t.regexp];for(var r=e,n=[];r;){var a=r.search(/\|=|\|~|!=|!~/);if(-1===a)break;var o=r.substr(a,2),i=0===r.substr(a).search(/!=|!~/);if(r=r.substr(a+2),!i){var u=r.search(/\|=|\|~|!=|!~/),s=void 0;-1===u?s=r.trim():(s=r.substr(0,u).trim(),r=r.substr(u));var c=s.match(/^"((?:[^\\"]|\\")*)"$/);if(!c)return null;var l=c[1],f="|~"===o;n.push(f?l:E()(l))}}return n}function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){C(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function D(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function q(e,t,r){var n=e.parsedLabels;!n&&e.labels&&(n=Object(a.parseLabels)(e.labels));var o=new a.ArrayVector([]),i=new a.ArrayVector([]),u=new a.ArrayVector([]),s=new a.ArrayVector([]),c=!0,l=!1,f=void 0;try{for(var p,m=e.entries[Symbol.iterator]();!(c=(p=m.next()).done);c=!0){var b=p.value,d=b.ts||b.timestamp;o.add(d),i.add(Object(a.dateTime)(d).valueOf()+"000000"),u.add(b.line),s.add(N(d,e.labels,b.line))}}catch(e){l=!0,f=e}finally{try{c||null==m.return||m.return()}finally{if(l)throw f}}return A(o,i,u,s,n,t,r)}function I(e,t,r){var n=e.stream,o=Object.entries(n).map((function(e){var t=D(e,2),r=t[0],n=t[1];return"".concat(r,'="').concat(n,'"')})).sort().join(""),i=new a.ArrayVector([]),u=new a.ArrayVector([]),s=new a.ArrayVector([]),c=new a.ArrayVector([]),l=!0,f=!1,p=void 0;try{for(var m,b=e.values[Symbol.iterator]();!(l=(m=b.next()).done);l=!0){var d=D(m.value,2),h=d[0],v=d[1];i.add(new Date(parseInt(h.substr(0,h.length-6),10)).toISOString()),u.add(h),s.add(v),c.add(N(h,o,v))}}catch(e){f=!0,p=e}finally{try{l||null==b.return||b.return()}finally{if(f)throw p}}return A(i,u,s,c,n,t,r)}function A(e,t,r,n,o,i,u){var s={refId:u,fields:[{name:"ts",type:a.FieldType.time,config:{title:"Time"},values:e},{name:"line",type:a.FieldType.string,config:{},values:r,labels:o},{name:"id",type:a.FieldType.string,config:{},values:n},{name:"tsNs",type:a.FieldType.time,config:{title:"Time ns"},values:t}],length:e.length};if(i){var c=new a.MutableDataFrame(s);return c.reverse(),c}return s}function N(e,t,r){return O()("".concat(e,"_").concat(t,"_").concat(r))}function Q(e,t){return{target:W(e.metric,t),datapoints:M(e.values,t),tags:e.metric}}function M(e,t){var r=1e3*t.step,n=[],a=t.start/1e6,o=!0,i=!1,u=void 0;try{for(var s,c=e[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var l=D(s.value,2),f=l[0],p=l[1],m=parseFloat(p);isNaN(m)&&(m=null);for(var b=1e3*f,d=a;d<b;d+=r)n.push([0,d]);a=b+r,n.push([m,b])}}catch(e){i=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw u}}for(var h=t.end/1e6,v=a;v<=h;v+=r)n.push([0,v]);return n}function V(e,t,r,n){if(!e||0===e.length)return new j.a;var o=F(new Set(e.reduce((function(e,t){return e.concat(Object.keys(t.metric))}),[])).values()).sort(),i=new j.a;return i.columns=[{text:"Time",type:a.FieldType.time}].concat(F(o.map((function(e){return{text:e,filterable:!0}}))),[{text:t>1||n?"Value #".concat(r):"Value",type:a.FieldType.time}]),e.forEach((function(e){var t,r={metric:e.metric,values:e.value?[e.value]:e.values};r.values&&(r.metric?(t=i.rows).push.apply(t,F(r.values.map((function(e){var t=D(e,2),n=t[0],a=t[1];return[1e3*n].concat(F(o.map((function(e){return r.metric[e]||""}))),[parseFloat(a)])})))):i.rows.concat(r.values.map((function(e){var t=D(e,2),r=t[0],n=t[1];return[1e3*r,parseFloat(n)]}))))})),i}function W(e,t){var r,n,a=void 0===t||i.a.isEmpty(t.legendFormat)?function(e){var t=e.__name__||"";delete e.__name__;var r=Object.entries(e).map((function(e){return"".concat(e[0],'="').concat(e[1],'"')})).join(",");return"".concat(t,"{").concat(r,"}")}(e):(r=w.b.replace(t.legendFormat),n=e,r.replace(/\{\{\s*(.+?)\s*\}\}/g,(function(e,t){return n[t]?n[t]:t})));return a||(a=t.query),a}function B(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=e.map((function(e){var o=I(e,a);return z(o,n),R({},o,{refId:t.refId,meta:{searchWords:L(T(t.expr,t.regexp)),limit:r}})}));return o}function U(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(0===Object.keys(e).length)return[];if(H(e))return[q(e,!1,t.refId)];var o=e.streams.map((function(e){var o=q(e,a);return z(o,n),R({},o,{refId:t.refId,meta:{searchWords:L(T(t.query,t.regexp)),limit:r}})}));return o}var z=function(e,t){var r;if(t){var n=null!==(r=t.derivedFields)&&void 0!==r?r:[];if(n.length){var o=n.reduce((function(e,t){var r={};t.url&&(r.links=[{url:t.url,title:""}]);var n={name:t.name,type:a.FieldType.string,config:r,values:new a.ArrayVector([])};return e[t.name]=n,e}),{});new a.DataFrameView(e).forEachRow((function(e){var t=!0,r=!1,a=void 0;try{for(var i,u=n[Symbol.iterator]();!(t=(i=u.next()).done);t=!0){var s=i.value,c=e.line.match(s.matcherRegex);o[s.name].values.add(c&&c[1])}}catch(e){r=!0,a=e}finally{try{t||null==u.return||u.return()}finally{if(r)throw a}}})),e.fields=[].concat(F(e.fields),F(Object.values(o)))}}};function K(e,t,r,a){var o={format:r.format,legendFormat:r.legendFormat,start:t.start,end:t.end,step:t.step,query:t.query,responseListLength:a,refId:r.refId,valueWithRefId:r.valueWithRefId};switch(e.data.resultType){case n.Vector:return e.data.result.map((function(e){return Q({metric:e.metric,values:[e.value]},o)}));case n.Matrix:return e.data.result.map((function(e){return Q(e,o)}));default:return[]}}function J(e,t,r,a,o,i){var u=arguments.length>6&&void 0!==arguments[6]&&arguments[6];switch(e.data.resultType){case n.Stream:return Object(l.a)({data:B(o>0?e.data.result:[],t,o,i,u),key:"".concat(t.refId,"_log")});case n.Vector:case n.Matrix:return Object(l.a)({data:K(e,r,R({},t,{format:"time_series"}),a),key:t.refId});default:throw new Error('Unknown result type "'.concat(e.data.resultType,'".'))}}function H(e){return!e.hasOwnProperty("streams")}var $=r("mrSG"),Z=r("K9Ia"),G=r("FFOo"),Y=r("6blF"),X=r("pugT"),ee=r("S5bw"),te={url:"",deserializer:function(e){return JSON.parse(e.data)},serializer:function(e){return JSON.stringify(e)}},re=function(e){function t(t,r){var n=e.call(this)||this;if(t instanceof Y.a)n.destination=r,n.source=t;else{var a=n._config=$.__assign({},te);if(n._output=new Z.b,"string"==typeof t)a.url=t;else for(var o in t)t.hasOwnProperty(o)&&(a[o]=t[o]);if(!a.WebSocketCtor&&WebSocket)a.WebSocketCtor=WebSocket;else if(!a.WebSocketCtor)throw new Error("no WebSocket constructor can be found");n.destination=new ee.a}return n}return $.__extends(t,e),t.prototype.lift=function(e){var r=new t(this._config,this.destination);return r.operator=e,r.source=this,r},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new ee.a),this._output=new Z.b},t.prototype.multiplex=function(e,t,r){var n=this;return new Y.a((function(a){try{n.next(e())}catch(e){a.error(e)}var o=n.subscribe((function(e){try{r(e)&&a.next(e)}catch(e){a.error(e)}}),(function(e){return a.error(e)}),(function(){return a.complete()}));return function(){try{n.next(t())}catch(e){a.error(e)}o.unsubscribe()}}))},t.prototype._connectSocket=function(){var e=this,t=this._config,r=t.WebSocketCtor,n=t.protocol,a=t.url,o=t.binaryType,i=this._output,u=null;try{u=n?new r(a,n):new r(a),this._socket=u,o&&(this._socket.binaryType=o)}catch(e){return void i.error(e)}var s=new X.a((function(){e._socket=null,u&&1===u.readyState&&u.close()}));u.onopen=function(t){if(!e._socket)return u.close(),void e._resetState();var r=e._config.openObserver;r&&r.next(t);var n=e.destination;e.destination=G.a.create((function(t){if(1===u.readyState)try{var r=e._config.serializer;u.send(r(t))}catch(t){e.destination.error(t)}}),(function(t){var r=e._config.closingObserver;r&&r.next(void 0),t&&t.code?u.close(t.code,t.reason):i.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),e._resetState()}),(function(){var t=e._config.closingObserver;t&&t.next(void 0),u.close(),e._resetState()})),n&&n instanceof ee.a&&s.add(n.subscribe(e.destination))},u.onerror=function(t){e._resetState(),i.error(t)},u.onclose=function(t){e._resetState();var r=e._config.closeObserver;r&&r.next(t),t.wasClean?i.complete():i.error(t)},u.onmessage=function(t){try{var r=e._config.deserializer;i.next(r(t))}catch(e){i.error(e)}}},t.prototype._subscribe=function(e){var t=this,r=this.source;return r?r.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add((function(){var e=t._socket;0===t._output.observers.length&&(e&&1===e.readyState&&e.close(),t._resetState())})),e)},t.prototype.unsubscribe=function(){var t=this._socket;t&&1===t.readyState&&t.close(),this._resetState(),e.prototype.unsubscribe.call(this)},t}(Z.a);function ne(e){return new re(e)}var ae=r("2WpN");function oe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ie=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streams={}}var t,r,n;return t=e,(r=[{key:"getLegacyStream",value:function(e){var t=this,r=this.streams[e.url];if(r)return r;var n=new a.CircularDataFrame({capacity:e.size});return n.addField({name:"ts",type:a.FieldType.time,config:{title:"Time"}}),n.addField({name:"line",type:a.FieldType.string}).labels=Object(a.parseLabels)(e.query),n.addField({name:"labels",type:a.FieldType.other}),n.addField({name:"id",type:a.FieldType.string}),r=ne(e.url).pipe(Object(ae.a)((function(){delete t.streams[e.url]})),Object(b.a)((function(e){return function(e,t){var r=e.streams;if(r&&r.length){var n={},o=!0,i=!1,u=void 0;try{for(var s,c=t.fields[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var l=s.value;if(l.type===a.FieldType.string){l.labels&&(n=l.labels);break}}}catch(e){i=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw u}}var f=!0,p=!1,m=void 0;try{for(var b,d=r[Symbol.iterator]();!(f=(b=d.next()).done);f=!0){var h=b.value,v=Object(a.parseLabels)(h.labels),y=Object(a.findUniqueLabels)(v,n),g=!0,x=!1,O=void 0;try{for(var w,j=h.entries[Symbol.iterator]();!(g=(w=j.next()).done);g=!0){var k=w.value,E=k.ts||k.timestamp;t.values.ts.add(E),t.values.line.add(k.line),t.values.labels.add(y),t.values.id.add(N(E,h.labels,k.line))}}catch(e){x=!0,O=e}finally{try{g||null==j.return||j.return()}finally{if(x)throw O}}}}catch(e){p=!0,m=e}finally{try{f||null==d.return||d.return()}finally{if(p)throw m}}}}(e,n),[n]}))),this.streams[e.url]=r,r}},{key:"getStream",value:function(e){var t=this,r=this.streams[e.url];if(r)return r;var n=new a.CircularDataFrame({capacity:e.size});return n.addField({name:"ts",type:a.FieldType.time,config:{title:"Time"}}),n.addField({name:"tsNs",type:a.FieldType.time,config:{title:"Time ns"}}),n.addField({name:"line",type:a.FieldType.string}).labels=Object(a.parseLabels)(e.query),n.addField({name:"labels",type:a.FieldType.other}),n.addField({name:"id",type:a.FieldType.string}),r=ne(e.url).pipe(Object(ae.a)((function(){delete t.streams[e.url]})),Object(b.a)((function(e){return function(e,t){var r=e.streams;if(r&&r.length){var n={},o=!0,i=!1,u=void 0;try{for(var s,c=t.fields[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var l=s.value;if(l.type===a.FieldType.string){l.labels&&(n=l.labels);break}}}catch(e){i=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw u}}var f=!0,p=!1,m=void 0;try{for(var b,d=r[Symbol.iterator]();!(f=(b=d.next()).done);f=!0){var h=b.value,v=Object(a.findUniqueLabels)(h.stream,n),y=Object.entries(h.stream).map((function(e){var t=D(e,2),r=t[0],n=t[1];return"".concat(r,'="').concat(n,'"')})).sort().join(""),g=!0,x=!1,O=void 0;try{for(var w,j=h.values[Symbol.iterator]();!(g=(w=j.next()).done);g=!0){var k=D(w.value,2),E=k[0],S=k[1];t.values.ts.add(new Date(parseInt(E.substr(0,E.length-6),10)).toISOString()),t.values.tsNs.add(E),t.values.line.add(S),t.values.labels.add(v),t.values.id.add(N(E,y,S))}}catch(e){x=!0,O=e}finally{try{g||null==j.return||j.return()}finally{if(x)throw O}}}}catch(e){p=!0,m=e}finally{try{f||null==d.return||d.return()}finally{if(p)throw m}}}}(e,n),[n]}))),this.streams[e.url]=r,r}}])&&oe(t.prototype,r),n&&oe(t,n),e}(),ue=r("HyWp"),se=r.n(ue),ce=r("ceQ3"),le=[].concat([{label:"sum",insertText:"sum",documentation:"Calculate sum over dimensions"},{label:"min",insertText:"min",documentation:"Select minimum over dimensions"},{label:"max",insertText:"max",documentation:"Select maximum over dimensions"},{label:"avg",insertText:"avg",documentation:"Calculate the average over dimensions"},{label:"stddev",insertText:"stddev",documentation:"Calculate population standard deviation over dimensions"},{label:"stdvar",insertText:"stdvar",documentation:"Calculate population standard variance over dimensions"},{label:"count",insertText:"count",documentation:"Count number of elements in the vector"},{label:"bottomk",insertText:"bottomk",documentation:"Smallest k elements by sample value"},{label:"topk",insertText:"topk",documentation:"Largest k elements by sample value"}],[{insertText:"count_over_time",label:"count_over_time",detail:"count_over_time(range-vector)",documentation:"The count of all values in the specified interval."},{insertText:"rate",label:"rate",detail:"rate(v range-vector)",documentation:"Calculates the per-second average rate of increase of the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. Also, the calculation extrapolates to the ends of the time range, allowing for missed scrapes or imperfect alignment of scrape cycles with the range's time period."}]),fe={comment:{pattern:/#.*/},"context-aggregation":{pattern:/((without|by)\s*)\([^)]*\)/,lookbehind:!0,inside:{"label-key":{pattern:/[^(),\s][^,)]*[^),\s]*/,alias:"attr-name"},punctuation:/[()]/}},"context-labels":{pattern:/\{[^}]*(?=})/,greedy:!0,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,alias:"attr-name",greedy:!0},"label-value":{pattern:/"(?:\\.|[^\\"])*"/,greedy:!0,alias:"attr-value"},punctuation:/[{]/}},function:new RegExp("\\b(?:".concat(le.map((function(e){return e.label})).join("|"),")(?=\\s*\\()"),"i"),"context-range":[{pattern:/\[[^\]]*(?=\])/,inside:{"range-duration":{pattern:/\b\d+[smhdwy]\b/i,alias:"number"}}},{pattern:/(offset\s+)\w+/,lookbehind:!0,inside:{"range-duration":{pattern:/\b\d+[smhdwy]\b/i,alias:"number"}}}],number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,operator:new RegExp("/&&?|\\|?\\||!=?|<(?:=>?|<|>)?|>[>=]?","i"),punctuation:/[{}()`,.]/},pe=r("itod");function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function de(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function he(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){de(o,n,a,i,u,"next",e)}function u(e){de(o,n,a,i,u,"throw",e)}i(void 0)}))}}function ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ge(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xe(e,t){return(xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function we(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(r),!0).forEach((function(t){je(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function je(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ke=["job","namespace"],Ee=function(e){return{label:e}},Se=function(e){return{start:1e6*e.from,end:1e6*e.to}};var _e=function(e){function t(e,r){var n,a,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,o=ye(t).call(this),(n=!o||"object"!==me(o)&&"function"!=typeof o?ge(a):o).seriesCache=new se.a(10),n.labelsCache=new se.a(10),n.cleanText=function(e){return e.replace(/[{}[\]="(),!~+\-*/^%]/g,"").trim()},n.request=function(){var e=he(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.datasource.metadataRequest(t,r);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0);case 9:return e.abrupt("return",void 0);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}(),n.start=function(){return n.startTask||(n.startTask=n.fetchLogLabels(n.initialRange).then((function(){return n.started=!0,[]}))),n.startTask},n.getBeginningCompletionItems=function(e){return{suggestions:[].concat(be(n.getEmptyCompletionItems(e).suggestions),be(n.getTermCompletionItems().suggestions))}},n.getTermCompletionItems=function(){var e=[];return e.push({prefixMatch:!0,label:"Functions",items:le.map((function(e){return we({},e,{kind:"function"})}))}),{suggestions:e}},n.fetchSeriesLabels=function(){var e=he(regeneratorRuntime.mark((function e(t,r){var a,o,i,u,s,c,l,f,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r?Se(r):{},o="/loki/api/v1/series",i=a.start,u=a.end,s=n.generateCacheKey(o,i,u,t),c={match:t,start:i,end:u},l=n.seriesCache.get(s)){e.next=14;break}return n.seriesCache.set(s,{}),e.next=10,n.request(o,c);case 10:f=e.sent,p=Object(ce.e)(f),m=p.values,l=m,n.seriesCache.set(s,l);case 14:return e.abrupt("return",l);case 15:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),n.datasource=e,n.labelKeys=[],Object.assign(ge(n),r),n}var r,n,o,u,s,c,l,f,p,m,b,d;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xe(e,t)}(t,e),r=t,(n=[{key:"getSyntax",value:function(){return fe}},{key:"getLabelKeys",value:function(){return this.labelKeys}},{key:"provideCompletionItems",value:(d=he(regeneratorRuntime.mark((function e(t,r){var n,a,o,i,u,s,c,l,f,p,m,b,d,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.wrapperClasses,a=t.value,o=t.prefix,i=t.text,u=0===a.document.text.length,s=a.document.getTextsAtRange(a.selection),c=1===s.size?s.first().getText():null,l=c?c[a.selection.anchor.offset]:null,f=n.length>3,p=o&&!f,m=!l||")"===l,b=o&&!i.match(/^['"~=\]})\s]+$/)&&m,d=/[+\-*/^%]/,h=i.match(d),!n.includes("context-range")){e.next=15;break}return e.abrupt("return",this.getRangeCompletionItems());case 15:if(!n.includes("context-labels")){e.next=21;break}return e.next=18,this.getLabelCompletionItems(t,r);case 18:return e.abrupt("return",e.sent);case 21:if(!u){e.next=25;break}return e.abrupt("return",this.getEmptyCompletionItems(r));case 25:if(!p||!m||h){e.next=29;break}return e.abrupt("return",this.getBeginningCompletionItems(r));case 29:if(!p||!b){e.next=31;break}return e.abrupt("return",this.getTermCompletionItems());case 31:return e.abrupt("return",{suggestions:[]});case 32:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"getEmptyCompletionItems",value:function(e){var t=null==e?void 0:e.history,r=[];if(t&&t.length){var n=i.a.chain(t).map((function(e){return e.query.expr})).filter().uniq().take(10).map(Ee).map((function(e){return function(e,t){var r=Date.now()-864e5,n=t.filter((function(t){return t.ts>r&&t.query.expr===e.label})),o="Queried ".concat(n.length," times in the last 24h."),i=n[0];if(i){var u=Object(a.dateTime)(i.ts).fromNow();o="".concat(o," Last queried ").concat(u,".")}return we({},e,{documentation:o})}(e,t)})).value();r.push({prefixMatch:!0,skipSort:!0,label:"History",items:n})}return{suggestions:r}}},{key:"getRangeCompletionItems",value:function(){return{context:"context-range",suggestions:[{label:"Range vector",items:be(pe.b)}]}}},{key:"getLabelCompletionItems",value:(b=he(regeneratorRuntime.mark((function e(t,r){var n,a,o,u,s,c,l,f,p,m,b,d,h,v,y,g,x,O,w,j;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.text,a=t.wrapperClasses,o=t.labelKey,u=t.value,s=r.absoluteRange,c="context-labels",l=[],f=u.anchorBlock.getText(),p=u.selection.anchor.offset,m=n.match(/^(=|=~|!=|!~)/);try{d=Object(ce.c)(f,p),b=d.selector}catch(e){b="{}"}if(m||"{}"!==b){e.next=13;break}return e.next=11,this.start();case 11:return h=this.getLabelKeys(),e.abrupt("return",{context:c,suggestions:[{label:"Labels",items:h.map(Ee)}]});case 13:if(v=d?d.labelKeys:[],!b){e.next=25;break}if("{}"!==b||!o){e.next=22;break}return e.next=18,this.getLabelValues(o);case 18:g=e.sent,y=je({},o,g),e.next=25;break;case 22:return e.next=24,this.getSeriesLabels(b,s);case 24:y=e.sent;case 25:if(y){e.next=28;break}return console.warn("Server did not return any values for selector = ".concat(b)),e.abrupt("return",{context:c,suggestions:l});case 28:return n&&m||a.includes("attr-value")?o&&y[o]&&(c="context-label-values",l.push({label:'Label values for "'.concat(o,'"'),items:y[o].map(Ee)})):(x=y?Object.keys(y):ke)&&(O=i.a.difference(x,v)).length&&(w=O.map((function(e){return{label:e}})),j={label:"Labels",items:w},l.push(j)),e.abrupt("return",{context:c,suggestions:l});case 30:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"importQueries",value:(m=he(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("prometheus"!==r){e.next=2;break}return e.abrupt("return",Promise.all(t.map(function(){var e=he(regeneratorRuntime.mark((function e(t){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.importPrometheusQuery(t.expr);case 2:return r=e.sent,a=t,o=Object.assign({},a),e.abrupt("return",we({},o,{expr:r}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 2:return e.abrupt("return",t.map((function(e){return{refId:e.refId,expr:""}})));case 3:case"end":return e.stop()}}),e)}))),function(e,t){return m.apply(this,arguments)})},{key:"importPrometheusQuery",value:(p=he(regeneratorRuntime.mark((function e(t){var r,n,a,o,i,u,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return","");case 2:if(r=t.match(ce.f)){e.next=5;break}return e.abrupt("return","");case 5:return n=r[0],a={},n.replace(ce.b,(function(e,t,r,n){return a[t]={value:n,operator:r},""})),e.next=10,this.start();case 10:if(o=this.labelKeys,i={},o&&o.length)for(u in a)o&&o.includes(u)&&(i[u]=a[u]);else i=a;return s=Object.keys(i).sort(),c=s.map((function(e){return"".concat(e).concat(i[e].operator).concat(i[e].value)})).join(","),e.abrupt("return",["{",c,"}"].join(""));case 16:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"getSeriesLabels",value:(f=he(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.lookupsDisabled){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.prev=2,e.next=5,this.fetchSeriesLabels(t,r);case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e,t){return f.apply(this,arguments)})},{key:"fetchLogLabels",value:(l=he(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,this.logLabelFetchTs=Date.now(),r=t?Se(t):{},e.next=6,this.request("/api/prom/label",r);case 6:n=e.sent,this.labelKeys=n.slice().sort(),this.logLabelOptions=this.labelKeys.map((function(e){return{label:e,value:e,isLeaf:!1}})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.error(e.t0);case 14:return e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e,this,[[1,11]])}))),function(e){return l.apply(this,arguments)})},{key:"refreshLogLabels",value:(c=he(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.labelKeys&&Date.now()-this.logLabelFetchTs>3e4||r)){e.next=3;break}return e.next=3,this.fetchLogLabels(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"generateCacheKey",value:function(e,t,r,n){return[e,this.roundTime(t),this.roundTime(r),n].join()}},{key:"roundTime",value:function(e){return e?Math.floor(e/1e6/1e3/60/5):0}},{key:"getLabelValues",value:(s=he(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchLabelValues(t,this.initialRange);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"fetchLabelValues",value:(u=he(regeneratorRuntime.mark((function e(t,r){var n,a,o,i,u,s,c,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="/api/prom/label/".concat(t,"/values"),a=[],o=r?Se(r):{},i=o.start,u=o.end,s=this.generateCacheKey(n,i,u,t),c={start:i,end:u},l=this.labelsCache.get(s)){e.next=22;break}return e.prev=8,this.labelsCache.set(s,[]),e.next=12,this.request(n,c);case 12:f=e.sent,a=f.slice().sort(),l=a,this.labelsCache.set(s,l),this.logLabelOptions=this.logLabelOptions.map((function(e){return e.value===t?we({},e,{children:a.map((function(e){return{label:e,value:e}}))}):e})),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),console.error(e.t0);case 22:return e.abrupt("return",l);case 23:case"end":return e.stop()}}),e,this,[[8,19]])}))),function(e,t){return u.apply(this,arguments)})}])&&ve(r.prototype,n),o&&ve(r,o),t}(a.LanguageProvider);function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Le(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function Pe(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Le(o,n,a,i,u,"next",e)}function u(e){Le(o,n,a,i,u,"throw",e)}i(void 0)}))}}function Re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ce(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(r),!0).forEach((function(t){Fe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function De(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ae(e,t){return(Ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ne="".concat("/api/prom","/query"),Qe="".concat("/loki/api/v1","/query_range"),Me="".concat("/loki/api/v1","/query"),Ve={direction:"BACKWARD",limit:1e3,regexp:"",query:""};function We(e){return Object.keys(e).map((function(t){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))})).join("&")}function Be(e){return"string"==typeof e?e.replace(/'/g,"\\\\'"):e}function Ue(e){return"string"==typeof e?Be(e.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&")):e}var ze=function(e){function t(e,r){var o,i,f;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=this,f=qe(t).call(this,e),(o=!f||"object"!==Te(f)&&"function"!=typeof f?Ie(i):f).instanceSettings=e,o.templateSrv=r,o.streams=new ie,o.runLegacyQuery=function(e,t){if(e.liveStreaming)return o.runLiveQuery(e,t);var r=t.range?{start:o.getTime(t.range.from,!1),end:o.getTime(t.range.to,!0)}:{},n=Ce({},Ve,{},_(e.expr),{},r,{limit:Math.min(t.maxDataPoints||1/0,o.maxLines),refId:e.refId});return o._request(Ne,n).pipe(Object(p.a)((function(t){return o.throwUnless(t,t.cancelled,e)})),Object(m.a)((function(e){return!e.cancelled})),Object(b.a)((function(r){return{data:U(r.data,n,o.maxLines,o.instanceSettings.jsonData,t.reverse),key:"".concat(e.refId,"_log")}})))},o.runInstantQuery=function(e,t,r){var a=o.getTime(t.range.to,!0),i={query:_(e.expr).query,time:"".concat(a+(1e9-a%1e9)),limit:Math.min(t.maxDataPoints||1/0,o.maxLines)};return o._request(Me,i).pipe(Object(p.a)((function(t){return o.throwUnless(t,t.cancelled,e)})),Object(m.a)((function(e){return!e.cancelled})),Object(b.a)((function(t){if(t.data.data.resultType===n.Stream)throw new Error("Metrics mode does not support logs. Use an aggregation or switch to Logs mode.");return{data:[V(t.data.data.result,r,e.refId,!0)],key:"".concat(e.refId,"_instant")}})))},o.runRangeQueryWithFallback=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=0;n=void 0===e.maxLines?Math.min(t.maxDataPoints||1/0,o.maxLines):isNaN(e.maxLines)?o.maxLines:e.maxLines;var a=Ce({},t,{maxDataPoints:n});if(e.liveStreaming)return o.runLiveQuery(e,a);var i=o.createRangeQuery(e,a);return o._request(Qe,i).pipe(Object(p.a)((function(t){return o.throwUnless(t,t.cancelled||404===t.status,e)})),Object(m.a)((function(e){return!e.cancelled})),Object(d.a)((function(c){return Object(u.a)((function(){return 404===c.status}),Object(s.a)((function(){return o.runLegacyQuery(e,a)})),Object(s.a)((function(){return J(c.data,e,i,r,n,o.instanceSettings.jsonData,t.reverse)})))})))},o.runLiveQuery=function(e,t){var r=o.createLiveTarget(e,t);return Object(c.a)(o.getVersion()).pipe(Object(h.a)((function(n){return Object(u.a)((function(){return"v1"===n}),Object(s.a)((function(){return o.streams.getStream(r)})),Object(s.a)((function(){var r=o.createLegacyLiveTarget(e,t);return o.streams.getLegacyStream(r)})))})),Object(b.a)((function(e){return{data:e,key:"loki-".concat(r.refId),state:a.LoadingState.Streaming}})))},o.getLogRowContext=function(e,t){var r=o.prepareLogRowContextQueryTarget(e,t&&t.limit||10,t&&t.direction||"BACKWARD"),n=t&&"FORWARD"===t.direction;return o._request(Qe,r).pipe(Object(p.a)((function(e){if(404===e.status)return Object(l.a)(e);throw{message:"Error during context query. Please check JS console logs.",status:e.status,statusText:e.statusText}})),Object(d.a)((function(e){return Object(u.a)((function(){return 404===e.status}),Object(s.a)((function(){return o._request(Ne,r).pipe(Object(p.a)((function(e){throw{message:"Error during context query. Please check JS console logs.",status:e.status,statusText:e.statusText}})),Object(b.a)((function(e){return{data:e.data?e.data.streams.map((function(e){return q(e,n)})):[]}})))})),Object(s.a)((function(){return Object(l.a)({data:e.data?e.data.data.result.map((function(e){return I(e,n)})):[]})})))}))).toPromise()},o.prepareLogRowContextQueryTarget=function(e,t,r){var n=Object.keys(e.labels).map((function(t){return"".concat(t,'="').concat(e.labels[t],'"')})).join(","),o={limit:t,query:"{".concat(n,"}"),expr:"{".concat(n,"}"),direction:r},i=new a.FieldCache(e.dataFrame).getFieldByName("tsNs").values.get(e.rowIndex);return Ce({},o,"BACKWARD"===r?{start:e.timeEpochMs-72e5+"000000",end:i,direction:r}:{start:i,end:e.timeEpochMs+72e5+"000000"})},o.throwUnless=function(e,t,r){if(t)return Object(l.a)(e);throw o.processError(e,r)},o.processError=function(e,t){var r={message:e&&e.statusText||"Unknown error during query transaction. Please check JS console logs.",refId:t.refId};return e.data?"string"==typeof e.data?r.message=e.data:e.data.error&&(r.message=Object(g.t)(e.data.error)):e.message?r.message=e.message:"string"==typeof e&&(r.message=e),r.status=e.status,r.statusText=e.statusText,r},o.languageProvider=new _e(Ie(o));var v=e.jsonData||{};return o.maxLines=parseInt(v.maxLines,10)||1e3,o}var r,i,x,O,w,j,k,E,S,P;return t.$inject=["instanceSettings","templateSrv"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ae(e,t)}(t,e),r=t,(i=[{key:"getVersion",value:function(){var e=this;return this.version?Promise.resolve(this.version):this._request(Qe).toPromise().then((function(){return e.version="v1",e.version})).catch((function(t){return e.version=404!==t.status?"v1":"v0",e.version}))}},{key:"_request",value:function(e,t,r){var n=this.instanceSettings.url,a=t?We(t):"",o=Ce({},r,{url:"".concat(n).concat(e).concat(a.length?"?".concat(a):"")});return Object(c.a)(Object(y.getBackendSrv)().datasourceRequest(o))}},{key:"query",value:function(e){var t=this,r=[],n=e.targets.filter((function(e){return e.expr&&!e.hide})).map((function(r){return Ce({},r,{expr:t.templateSrv.replace(r.expr,e.scopedVars,t.interpolateQueryExpr)})}));return e.exploreMode===a.ExploreMode.Metrics?n.forEach((function(a){return r.push(t.runInstantQuery(a,e,n.length),t.runRangeQueryWithFallback(a,e,n.length))})):n.forEach((function(o){return r.push(t.runRangeQueryWithFallback(o,e,n.length).pipe(Object(b.a)((function(t){if(e.exploreMode===a.ExploreMode.Logs&&t.data.find((function(e){return e.hasOwnProperty("datapoints")})))throw new Error("Logs mode does not support queries that return time series data. Please perform a logs query or switch to Metrics mode.");return t}))))})),Object(o.isEmpty)(r)?Object(l.a)({data:[],state:a.LoadingState.Done}):f.a.apply(void 0,r)}},{key:"createRangeQuery",value:function(e,t){var r=_(e.expr).query,n={};if(t.range){var a=this.getTime(t.range.from,!1),o=this.getTime(t.range.to,!0),i=Math.ceil((o-a)/1e6),u=Math.ceil(this.adjustInterval(t.intervalMs||1e3,i)/1e3),s={start:a-a%1e9,end:o+(1e9-o%1e9)};n={start:s.start,end:s.end,step:u}}return Ce({},Ve,{},n,{query:r,limit:Math.min(t.maxDataPoints||1/0,this.maxLines)})}},{key:"createLegacyLiveTarget",value:function(e,t){var r=_(e.expr),n=r.query,a=r.regexp,o=this.instanceSettings.url,i=We({query:n});return{query:n,regexp:a,url:Object(g.f)("".concat(o,"/api/prom/tail?").concat(i)),refId:e.refId,size:Math.min(t.maxDataPoints||1/0,this.maxLines)}}},{key:"createLiveTarget",value:function(e,t){var r=_(e.expr),n=r.query,a=r.regexp,o=this.instanceSettings.url,i=We({query:n});return{query:n,regexp:a,url:Object(g.f)("".concat(o,"/loki/api/v1/tail?").concat(i)),refId:e.refId,size:Math.min(t.maxDataPoints||1/0,this.maxLines)}}},{key:"interpolateVariablesInQueries",value:function(e,t){var r=this,n=e;return e&&e.length&&(n=e.map((function(e){return Ce({},e,{datasource:r.name,expr:r.templateSrv.replace(e.expr,t,r.interpolateQueryExpr)})}))),n}},{key:"getQueryDisplayText",value:function(e){return e.expr}},{key:"importQueries",value:(P=Pe(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.languageProvider.importQueries(t,r.id));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"metadataRequest",value:(S=Pe(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._request(t,r,{silent:!0}).toPromise();case 2:return n=e.sent,e.abrupt("return",n.data.data||n.data.values||[]);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"metricFindQuery",value:(E=Pe(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.resolve([]));case 2:return r=this.templateSrv.replace(t,{},this.interpolateQueryExpr),e.next=5,this.processMetricFindQuery(r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"processMetricFindQuery",value:(k=Pe(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=/^label_names\(\)\s*$/,n=/^label_values\((?:(.+),\s*)?([a-zA-Z_][a-zA-Z0-9_]*)\)\s*$/,!t.match(r)){e.next=7;break}return e.next=6,this.labelNamesQuery();case 6:return e.abrupt("return",e.sent);case 7:if(!(a=t.match(n))){e.next=12;break}return e.next=11,this.labelValuesQuery(a[2]);case 11:return e.abrupt("return",e.sent);case 12:return e.abrupt("return",Promise.resolve([]));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"labelNamesQuery",value:(j=Pe(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersion();case 2:if(e.t0=e.sent,"v0"!==e.t0){e.next=7;break}e.t1="".concat("/api/prom","/label"),e.next=8;break;case 7:e.t1="".concat("/loki/api/v1","/label");case 8:return t=e.t1,e.next=11,this.metadataRequest(t);case 11:return r=e.sent,e.abrupt("return",r.map((function(e){return{text:e}})));case 13:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"labelValuesQuery",value:(w=Pe(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersion();case 2:if(e.t0=e.sent,"v0"!==e.t0){e.next=7;break}e.t1="".concat("/api/prom","/label/").concat(t,"/values"),e.next=8;break;case 7:e.t1="".concat("/loki/api/v1","/label/").concat(t,"/values");case 8:return r=e.t1,e.next=11,this.metadataRequest(r);case 11:return n=e.sent,e.abrupt("return",n.map((function(e){return{text:e}})));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"interpolateQueryExpr",value:function(e,t){return t.multi||t.includeAll?"string"==typeof e?Ue(e):Object(o.map)(e,Ue).join("|"):Be(e)}},{key:"modifyQuery",value:function(e,t){var r,n,a=_(e.expr||""),o=a.query;switch(t.type){case"ADD_FILTER":r=Object(v.a)(o,t.key,t.value),n=Object(v.c)(o),o="".concat(r," ").concat(n).trim();break;case"ADD_FILTER_OUT":r=Object(v.a)(o,t.key,t.value,"!="),n=Object(v.c)(o),o="".concat(r," ").concat(n).trim()}return Ce({},e,{expr:T(o,a.regexp)})}},{key:"getHighlighterExpression",value:function(e){return L(e.expr)}},{key:"getTime",value:function(e,t){return"string"==typeof e&&(e=a.dateMath.parse(e,t)),Math.ceil(1e6*e.valueOf())}},{key:"testDatasource",value:function(){var e=this,t=Date.now()-6e5,r="".concat(t,"000000");return this._request("/loki/api/v1/label",{start:r}).pipe(Object(p.a)((function(e){if(404===e.status)return Object(l.a)(e);throw e})),Object(d.a)((function(t){return Object(u.a)((function(){return 404===t.status}),Object(s.a)((function(){return e._request("/api/prom/label",{start:r})})),Object(s.a)((function(){return Object(l.a)(t)})))})),Object(b.a)((function(e){var t,r;return((null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.data)||(null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.values)||[]).length>0?{status:"success",message:"Data source connected and labels found."}:{status:"error",message:"Data source connected, but no labels received. Verify that Loki and Promtail is configured properly."}})),Object(p.a)((function(e){var t="Loki: ";return e.statusText?t+=e.statusText:t+="Cannot connect to Loki",e.status&&(t+=". ".concat(e.status)),e.data&&e.data.message?t+=". ".concat(e.data.message):e.data&&(t+=". ".concat(e.data)),Object(l.a)({status:"error",message:t})}))).toPromise()}},{key:"annotationQuery",value:(O=Pe(regeneratorRuntime.mark((function e(t){var r,n,o,i,u,s,c,l,f,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.annotation.expr){e.next=2;break}return e.abrupt("return",[]);case 2:return r=this.templateSrv.replace(t.annotation.expr,{},this.interpolateQueryExpr),n={refId:"annotation-".concat(t.annotation.name),expr:r},e.next=6,this.runRangeQueryWithFallback(n,t).toPromise();case 6:for(o=e.sent,i=o.data,u=[],s=!0,c=!1,l=void 0,e.prev=12,f=function(){var e=m.value,t=[],r=!0,n=!1,o=void 0;try{for(var i,s=e.fields[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;c.labels&&t.push.apply(t,Object.values(c.labels))}}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}new a.DataFrameView(e).forEachRow((function(e){u.push({time:new Date(e.ts).valueOf(),text:e.line,tags:t})}))},p=i[Symbol.iterator]();!(s=(m=p.next()).done);s=!0)f();e.next=21;break;case 17:e.prev=17,e.t0=e.catch(12),c=!0,l=e.t0;case 21:e.prev=21,e.prev=22,s||null==p.return||p.return();case 24:if(e.prev=24,!c){e.next=27;break}throw l;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.abrupt("return",u);case 30:case"end":return e.stop()}}),e,this,[[12,17,21,29],[22,,24,28]])}))),function(e){return O.apply(this,arguments)})},{key:"adjustInterval",value:function(e,t){return 0!==e&&t/e>11e3&&(e=Math.ceil(t/11e3)),Math.max(e,1e3)}}])&&De(r.prototype,i),x&&De(r,x),t}(a.DataSourceApi);var Ke=r("q1tI"),Je=r.n(Ke);function He(e){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function Ze(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){$e(o,n,a,i,u,"next",e)}function u(e){$e(o,n,a,i,u,"throw",e)}i(void 0)}))}}function Ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Xe(e,t){return!t||"object"!==He(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function et(e){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tt(e,t){return(tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rt=['{job="default/prometheus"}'],nt=["job","app","k8s_app"],at=[{title:"Count over time",expression:'count_over_time({job="mysql"}[5m])',label:"This query counts all the log lines within the last five minutes for the MySQL job."},{title:"Rate",expression:'rate(({job="mysql"} |= "error" != "timeout")[10s])',label:"This query gets the per-second rate of all non-timeout errors within the last ten seconds for the MySQL job."},{title:"Aggregate, count, and group",expression:'sum(count_over_time({job="mysql"}[5m])) by (level)',label:"Get the count of logs during the last five minutes, grouping by level."}],ot=function(e){function t(){var e,r;Ge(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(r=Xe(this,(e=et(t)).call.apply(e,[this].concat(a)))).state={userExamples:rt},r.checkUserLabels=Ze(regeneratorRuntime.mark((function e(){var t,n,a,i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=r.props.datasource.languageProvider).started){e.next=12;break}if(n=t.getLabelKeys()||[],!(a=nt.find((function(e){return n.includes(e)})))){e.next=10;break}return e.next=7,t.getLabelValues(a);case 7:i=e.sent,u=Object(o.shuffle)(i).slice(0,5).map((function(e){return"{".concat(a,'="').concat(e,'"}')})),r.setState({userExamples:u});case 10:e.next=13;break;case 12:r.scheduleUserLabelChecking();case 13:case"end":return e.stop()}}),e)}))),r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tt(e,t)}(t,e),r=t,(n=[{key:"componentDidMount",value:function(){this.scheduleUserLabelChecking()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.userLabelTimer)}},{key:"scheduleUserLabelChecking",value:function(){this.userLabelTimer=setTimeout(this.checkUserLabels,1e3)}},{key:"renderExpression",value:function(e){var t=this.props.onClickExample;return Je.a.createElement("div",{className:"cheat-sheet-item__example",key:e,onClick:function(r){return t({refId:"A",expr:e})}},Je.a.createElement("code",null,e))}},{key:"renderLogsCheatSheet",value:function(){var e=this,t=this.state.userExamples;return Je.a.createElement(Je.a.Fragment,null,Je.a.createElement("h2",null,"Loki Cheat Sheet"),Je.a.createElement("div",{className:"cheat-sheet-item"},Je.a.createElement("div",{className:"cheat-sheet-item__title"},"See your logs"),Je.a.createElement("div",{className:"cheat-sheet-item__label"},"Start by selecting a log stream from the Log labels selector."),Je.a.createElement("div",{className:"cheat-sheet-item__label"},"Alternatively, you can write a stream selector into the query field:"),this.renderExpression('{job="default/prometheus"}'),t!==rt&&t.length>0?Je.a.createElement("div",null,Je.a.createElement("div",{className:"cheat-sheet-item__label"},"Here are some example streams from your logs:"),t.map((function(t){return e.renderExpression(t)}))):null),Je.a.createElement("div",{className:"cheat-sheet-item"},Je.a.createElement("div",{className:"cheat-sheet-item__title"},"Combine stream selectors"),this.renderExpression('{app="cassandra",namespace="prod"}'),Je.a.createElement("div",{className:"cheat-sheet-item__label"},"Returns all log lines from streams that have both labels.")),Je.a.createElement("div",{className:"cheat-sheet-item"},Je.a.createElement("div",{className:"cheat-sheet-item__title"},"Filtering for search terms."),this.renderExpression('{app="cassandra"} |~ "(duration|latency)s*(=|is|of)s*[d.]+"'),this.renderExpression('{app="cassandra"} |= "exact match"'),this.renderExpression('{app="cassandra"} != "do not match"'),Je.a.createElement("div",{className:"cheat-sheet-item__label"},Je.a.createElement("a",{href:"https://github.com/grafana/loki/blob/master/docs/logql.md#filter-expression",target:"logql"},"LogQL")," ","supports exact and regular expression filters.")))}},{key:"renderMetricsCheatSheet",value:function(){var e=this;return Je.a.createElement("div",null,Je.a.createElement("h2",null,"LogQL Cheat Sheet"),at.map((function(t){return Je.a.createElement("div",{className:"cheat-sheet-item",key:t.expression},Je.a.createElement("div",{className:"cheat-sheet-item__title"},t.title),e.renderExpression(t.expression),Je.a.createElement("div",{className:"cheat-sheet-item__label"},t.label))})))}},{key:"render",value:function(){return this.props.exploreMode===a.ExploreMode.Logs?this.renderLogsCheatSheet():this.renderMetricsCheatSheet()}}])&&Ye(r.prototype,n),i&&Ye(r,i),t}(Ke.PureComponent),it=r("KwPh"),ut=r("Yj82");function st(){return(st=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function ct(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var lt=function(e){var t=e.datasource,r=e.absoluteRange,n=ct(e,["datasource","absoluteRange"]),a=Object(ut.a)(t.languageProvider,r),o=a.isSyntaxReady,i=a.setActiveOption,u=a.refreshLabels,s=a.syntax,c=a.logLabelOptions;return Je.a.createElement(it.a,st({datasource:t,onLoadOptions:i,onLabelsRefresh:u,absoluteRange:r,syntax:s,syntaxLoaded:o,logLabelOptions:c},n))},ft=r("kDLi");var pt=Object(Ke.memo)((function(e){var t=e.label,r=e.onChangeFunc,n=e.onKeyDownFunc,a=e.value,o=e.type,i=e.min;return Je.a.createElement("div",{className:"gf-form-inline explore-input--ml"},Je.a.createElement("div",{className:"gf-form"},Je.a.createElement(ft.FormLabel,{width:6},t),Je.a.createElement("input",{type:o,className:"gf-form-input width-6",placeholder:"auto",onChange:r,onKeyDown:n,min:i,value:a})))}));function mt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function bt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var dt=Object(Ke.memo)((function(e){var t,r,n=e.query,o=e.data,u=e.datasource,s=e.exploreMode,c=e.history,l=e.onChange,f=e.onRunQuery;if(o&&!i.a.isEmpty(o.request)){var p=o.request.range;r={from:p.from.valueOf(),to:p.to.valueOf()}}else r={from:Date.now()-1e4,to:Date.now()};function m(t){var r=e.query;(0,e.onChange)(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(r),!0).forEach((function(t){bt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},r,{maxLines:b(t)}))}function b(e){return 0===e.length?NaN:e.length>0&&(isNaN(+e)||+e<0)?0:+e}return Je.a.createElement(lt,{datasource:u,query:n,onChange:l,onRunQuery:f,history:c,data:o,absoluteRange:r,ExtraFieldElement:s===a.ExploreMode.Logs?Je.a.createElement(pt,{label:"Line limit",onChangeFunc:function(e){n.maxLines!==b(e.currentTarget.value)&&m(e.currentTarget.value)},onKeyDownFunc:function(e){"Enter"===e.key&&f()},value:(null==n?void 0:null===(t=n.maxLines)||void 0===t?void 0:t.toString())||"",type:"number",min:0}):null})})),ht=Object(Ke.memo)((function(e){var t,r=e.query,n=e.data,a=e.datasource,o=e.onChange,i=e.onRunQuery;if(n&&n.request){var u=n.request.range;t={from:u.from.valueOf(),to:u.to.valueOf()}}else t={from:Date.now()-1e4,to:Date.now()};return Je.a.createElement("div",null,Je.a.createElement(lt,{datasource:a,query:r,onChange:o,onRunQuery:i,history:[],data:n,absoluteRange:t}))}));function vt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var yt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.annotation.target=this.annotation.target||{},this.onQueryChange=this.onQueryChange.bind(this)}var t,r,n;return t=e,(r=[{key:"onQueryChange",value:function(e){this.annotation.expr=e}}])&&vt(t.prototype,r),n&&vt(t,n),e}();yt.templateUrl="partials/annotations.editor.html";var gt=function(e){var t=e.value,r=e.onChange;return Je.a.createElement(ft.FormField,{label:"Maximum lines",labelWidth:11,inputWidth:20,inputEl:Je.a.createElement("input",{type:"number",className:"gf-form-input width-8 gf-form-input--has-help-icon",value:t,onChange:function(e){return r(e.currentTarget.value)},spellCheck:!1,placeholder:"1000"}),tooltip:Je.a.createElement(Je.a.Fragment,null,"Loki queries must contain a limit of the maximum number of lines returned (default: 1000). Increase this limit to have a bigger result set for ad-hoc analysis. Decrease this limit if your browser becomes sluggish when displaying the log results.")})},xt=r("kDDq");function Ot(){var e=Lt(["\n          width: 100%;\n        "]);return Ot=function(){return e},e}function wt(){var e=Lt(["\n            margin-left: 8px;\n          "]);return wt=function(){return e},e}function jt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function kt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(r),!0).forEach((function(t){Et(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Et(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function St(){var e=Lt(["\n    flex: 3;\n  "]);return St=function(){return e},e}function _t(){var e=Lt(["\n    flex: 2;\n  "]);return _t=function(){return e},e}function Tt(){var e=Lt(["\n    display: flex;\n    align-items: baseline;\n  "]);return Tt=function(){return e},e}function Lt(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var Pt=Object(ft.stylesFactory)((function(){return{firstRow:Object(xt.css)(Tt()),nameField:Object(xt.css)(_t()),regexField:Object(xt.css)(St())}})),Rt=function(e){var t=e.value,r=e.onChange,n=e.onDelete,a=e.suggestions,o=e.className,i=Pt(),u=function(e){return function(n){r(kt({},t,Et({},e,n.currentTarget.value)))}};return Je.a.createElement("div",{className:o},Je.a.createElement("div",{className:i.firstRow},Je.a.createElement(ft.FormField,{className:i.nameField,labelWidth:5,inputWidth:null,label:"Name",type:"text",value:t.name,onChange:u("name")}),Je.a.createElement(ft.FormField,{className:i.regexField,inputWidth:null,label:"Regex",type:"text",value:t.matcherRegex,onChange:u("matcherRegex"),tooltip:"Use to parse and capture some part of the log message. You can use the captured groups in the template."}),Je.a.createElement(ft.Button,{variant:"inverse",title:"Remove field",icon:"fa fa-times",onClick:function(e){e.preventDefault(),n()},className:Object(xt.css)(wt())})),Je.a.createElement(ft.FormField,{label:"URL",labelWidth:5,inputEl:Je.a.createElement(ft.DataLinkInput,{placeholder:"http://example.com/${__value.raw}",value:t.url||"",onChange:function(e){return r(kt({},t,{url:e}))},suggestions:a}),className:Object(xt.css)(Ot())}))},Ct=r("TSYQ"),Ft=r.n(Ct),Dt=r("MAcC");function qt(){var e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n                width: 100%;\n              "]);return qt=function(){return e},e}function It(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var At=function(e){var t=e.derivedFields,r=e.className,n=It(Object(Ke.useState)(""),2),o=n[0],i=n[1],u=[];return o&&t&&(u=function(e,t){return e.filter((function(e){return e.name&&e.matcherRegex})).map((function(e){try{var r,n=t.match(e.matcherRegex),o=n&&n[1];return e.url&&o&&(r=Object(Dt.b)({name:"",type:a.FieldType.string,values:new a.ArrayVector([o]),config:{links:[{title:"",url:e.url}]}},0)[0]),{name:e.name,value:o||"<no match>",href:r&&r.href}}catch(t){return{name:e.name,error:t}}}))}(t,o)),Je.a.createElement("div",{className:r},Je.a.createElement(ft.FormField,{labelWidth:12,label:"Debug log message",inputEl:Je.a.createElement("textarea",{placeholder:"Paste an example log line here to test the regular expressions of your derived fields",className:Ft()("gf-form-input gf-form-textarea",Object(xt.css)(qt())),value:o,onChange:function(e){return i(e.currentTarget.value)}})}),!!u.length&&Je.a.createElement(Nt,{fields:u}))},Nt=function(e){var t=e.fields;return Je.a.createElement("table",{className:"filter-table"},Je.a.createElement("thead",null,Je.a.createElement("tr",null,Je.a.createElement("th",null,"Name"),Je.a.createElement("th",null,"Value"),Je.a.createElement("th",null,"Url"))),Je.a.createElement("tbody",null,t.map((function(e){var t=e.value;return e.error?t=e.error.message:e.href&&(t=Je.a.createElement("a",{href:e.href},t)),Je.a.createElement("tr",{key:"".concat(e.name,"=").concat(e.value)},Je.a.createElement("td",null,e.name),Je.a.createElement("td",null,t),Je.a.createElement("td",null,e.href?Je.a.createElement("a",{href:e.href},e.href):""))}))))};function Qt(){var e=zt(["\n              margin-bottom: 10px;\n            "]);return Qt=function(){return e},e}function Mt(){var e=zt(["\n              margin-right: 10px;\n            "]);return Mt=function(){return e},e}function Vt(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Wt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Bt(){var e=zt(["\n    margin-bottom: ",";\n  "]);return Bt=function(){return e},e}function Ut(){var e=zt(["\n    padding-bottom: ",";\n    color: ",";\n  "]);return Ut=function(){return e},e}function zt(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var Kt=Object(ft.stylesFactory)((function(e){return{infoText:Object(xt.css)(Ut(),e.spacing.md,e.colors.textWeak),derivedField:Object(xt.css)(Bt(),e.spacing.sm)}})),Jt=function(e){var t=e.value,r=e.onChange,n=Object(ft.useTheme)(),o=Kt(n),i=Wt(Object(Ke.useState)(!1),2),u=i[0],s=i[1];return Je.a.createElement(Je.a.Fragment,null,Je.a.createElement("h3",{className:"page-heading"},"Derived fields"),Je.a.createElement("div",{className:o.infoText},"Derived fields can be used to extract new fields from the log message and create link from it's value."),Je.a.createElement("div",{className:"gf-form-group"},t&&t.map((function(e,n){return Je.a.createElement(Rt,{className:o.derivedField,key:n,value:e,onChange:function(e){var a=Vt(t);a.splice(n,1,e),r(a)},onDelete:function(){var e=Vt(t);e.splice(n,1),r(e)},suggestions:[{value:ft.DataLinkBuiltInVars.valueRaw,label:"Raw value",documentation:"Exact string captured by the regular expression",origin:a.VariableOrigin.Value}]})})),Je.a.createElement("div",null,Je.a.createElement(ft.Button,{variant:"inverse",className:Object(xt.css)(Mt()),icon:"fa fa-plus",onClick:function(e){e.preventDefault();var n=[].concat(Vt(t||[]),[{name:"",matcherRegex:""}]);r(n)}},"Add"),t&&t.length>0&&Je.a.createElement(ft.Button,{variant:"inverse",onClick:function(){return s(!u)}},u?"Hide example log message":"Show example log message"))),u&&Je.a.createElement("div",{className:"gf-form-group"},Je.a.createElement(At,{className:Object(xt.css)(Qt()),derivedFields:t})))};function Ht(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $t(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(r),!0).forEach((function(t){Zt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ht(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Zt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Gt=function(e){return function(t,r){return $t({},t,{jsonData:$t({},t.jsonData,Zt({},e,r))})}},Yt=Gt("maxLines"),Xt=Gt("derivedFields");r.d(t,"plugin",(function(){return er}));var er=new a.DataSourcePlugin(ze).setQueryEditor(ht).setConfigEditor((function(e){var t=e.options,r=e.onOptionsChange;return Je.a.createElement(Je.a.Fragment,null,Je.a.createElement(ft.DataSourceHttpSettings,{defaultUrl:"http://localhost:3100",dataSourceConfig:t,showAccessOptions:!1,onChange:r}),Je.a.createElement("div",{className:"gf-form-group"},Je.a.createElement("div",{className:"gf-form-inline"},Je.a.createElement("div",{className:"gf-form"},Je.a.createElement(gt,{value:t.jsonData.maxLines,onChange:function(e){return r(Yt(t,e))}})))),Je.a.createElement(Jt,{value:t.jsonData.derivedFields,onChange:function(e){return r(Xt(t,e))}}))})).setExploreQueryField(dt).setExploreStartPage(ot).setAnnotationQueryCtrl(yt)},ANhw:function(e,t){var r,n;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],n=0;n<e.length;n+=3)for(var a=e[n]<<16|e[n+1]<<8|e[n+2],o=0;o<4;o++)8*n+6*o<=8*e.length?t.push(r.charAt(a>>>6*(3-o)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],n=0,a=0;n<e.length;a=++n%4)0!=a&&t.push((r.indexOf(e.charAt(n-1))&Math.pow(2,-2*a+8)-1)<<2*a|r.indexOf(e.charAt(n))>>>6-2*a);return t}},e.exports=n},BEtg:function(e,t){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},aCH8:function(e,t,r){var n,a,o,i,u;n=r("ANhw"),a=r("mmNF").utf8,o=r("BEtg"),i=r("mmNF").bin,(u=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?i.stringToBytes(e):a.stringToBytes(e):o(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());for(var r=n.bytesToWords(e),s=8*e.length,c=1732584193,l=-271733879,f=-1732584194,p=271733878,m=0;m<r.length;m++)r[m]=16711935&(r[m]<<8|r[m]>>>24)|4278255360&(r[m]<<24|r[m]>>>8);r[s>>>5]|=128<<s%32,r[14+(s+64>>>9<<4)]=s;var b=u._ff,d=u._gg,h=u._hh,v=u._ii;for(m=0;m<r.length;m+=16){var y=c,g=l,x=f,O=p;c=b(c,l,f,p,r[m+0],7,-680876936),p=b(p,c,l,f,r[m+1],12,-389564586),f=b(f,p,c,l,r[m+2],17,606105819),l=b(l,f,p,c,r[m+3],22,-1044525330),c=b(c,l,f,p,r[m+4],7,-176418897),p=b(p,c,l,f,r[m+5],12,1200080426),f=b(f,p,c,l,r[m+6],17,-1473231341),l=b(l,f,p,c,r[m+7],22,-45705983),c=b(c,l,f,p,r[m+8],7,1770035416),p=b(p,c,l,f,r[m+9],12,-1958414417),f=b(f,p,c,l,r[m+10],17,-42063),l=b(l,f,p,c,r[m+11],22,-1990404162),c=b(c,l,f,p,r[m+12],7,1804603682),p=b(p,c,l,f,r[m+13],12,-40341101),f=b(f,p,c,l,r[m+14],17,-1502002290),c=d(c,l=b(l,f,p,c,r[m+15],22,1236535329),f,p,r[m+1],5,-165796510),p=d(p,c,l,f,r[m+6],9,-1069501632),f=d(f,p,c,l,r[m+11],14,643717713),l=d(l,f,p,c,r[m+0],20,-373897302),c=d(c,l,f,p,r[m+5],5,-701558691),p=d(p,c,l,f,r[m+10],9,38016083),f=d(f,p,c,l,r[m+15],14,-660478335),l=d(l,f,p,c,r[m+4],20,-405537848),c=d(c,l,f,p,r[m+9],5,568446438),p=d(p,c,l,f,r[m+14],9,-1019803690),f=d(f,p,c,l,r[m+3],14,-187363961),l=d(l,f,p,c,r[m+8],20,1163531501),c=d(c,l,f,p,r[m+13],5,-1444681467),p=d(p,c,l,f,r[m+2],9,-51403784),f=d(f,p,c,l,r[m+7],14,1735328473),c=h(c,l=d(l,f,p,c,r[m+12],20,-1926607734),f,p,r[m+5],4,-378558),p=h(p,c,l,f,r[m+8],11,-2022574463),f=h(f,p,c,l,r[m+11],16,1839030562),l=h(l,f,p,c,r[m+14],23,-35309556),c=h(c,l,f,p,r[m+1],4,-1530992060),p=h(p,c,l,f,r[m+4],11,1272893353),f=h(f,p,c,l,r[m+7],16,-155497632),l=h(l,f,p,c,r[m+10],23,-1094730640),c=h(c,l,f,p,r[m+13],4,681279174),p=h(p,c,l,f,r[m+0],11,-358537222),f=h(f,p,c,l,r[m+3],16,-722521979),l=h(l,f,p,c,r[m+6],23,76029189),c=h(c,l,f,p,r[m+9],4,-640364487),p=h(p,c,l,f,r[m+12],11,-421815835),f=h(f,p,c,l,r[m+15],16,530742520),c=v(c,l=h(l,f,p,c,r[m+2],23,-995338651),f,p,r[m+0],6,-198630844),p=v(p,c,l,f,r[m+7],10,1126891415),f=v(f,p,c,l,r[m+14],15,-1416354905),l=v(l,f,p,c,r[m+5],21,-57434055),c=v(c,l,f,p,r[m+12],6,1700485571),p=v(p,c,l,f,r[m+3],10,-1894986606),f=v(f,p,c,l,r[m+10],15,-1051523),l=v(l,f,p,c,r[m+1],21,-2054922799),c=v(c,l,f,p,r[m+8],6,1873313359),p=v(p,c,l,f,r[m+15],10,-30611744),f=v(f,p,c,l,r[m+6],15,-1560198380),l=v(l,f,p,c,r[m+13],21,1309151649),c=v(c,l,f,p,r[m+4],6,-145523070),p=v(p,c,l,f,r[m+11],10,-1120210379),f=v(f,p,c,l,r[m+2],15,718787259),l=v(l,f,p,c,r[m+9],21,-343485551),c=c+y>>>0,l=l+g>>>0,f=f+x>>>0,p=p+O>>>0}return n.endian([c,l,f,p])})._ff=function(e,t,r,n,a,o,i){var u=e+(t&r|~t&n)+(a>>>0)+i;return(u<<o|u>>>32-o)+t},u._gg=function(e,t,r,n,a,o,i){var u=e+(t&n|r&~n)+(a>>>0)+i;return(u<<o|u>>>32-o)+t},u._hh=function(e,t,r,n,a,o,i){var u=e+(t^r^n)+(a>>>0)+i;return(u<<o|u>>>32-o)+t},u._ii=function(e,t,r,n,a,o,i){var u=e+(r^(t|~n))+(a>>>0)+i;return(u<<o|u>>>32-o)+t},u._blocksize=16,u._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var r=n.wordsToBytes(u(e,t));return t&&t.asBytes?r:t&&t.asString?i.bytesToString(r):n.bytesToHex(r)}},kGJw:function(e,t,r){var n=r("dt0z"),a=/[\\^$.*+?()[\]{}|]/g,o=RegExp(a.source);e.exports=function(e){return(e=n(e))&&o.test(e)?e.replace(a,"\\$&"):e}},mmNF:function(e,t){var r={utf8:{stringToBytes:function(e){return r.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(r.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=r}}]);
//# sourceMappingURL=lokiPlugin.898fe9e20a782b4232fe.js.map