(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{Z209:function(e,t,n){"use strict";n.r(t);var r=n("KHwQ"),a=n.n(r),i=n("txxJ"),o=n("LvDl"),s=n.n(o);var c=function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.init=function(){var e=t.target;e.namespace=e.namespace||"",e.metricName=e.metricName||"",e.statistics=e.statistics||["Average"],e.dimensions=e.dimensions||{},e.period=e.period||"",e.region=e.region||"default",e.id=e.id||"",e.expression=e.expression||"",t.regionSegment=r.getSegmentForValue(t.target.region,"select region"),t.namespaceSegment=r.getSegmentForValue(t.target.namespace,"select namespace"),t.metricSegment=r.getSegmentForValue(t.target.metricName,"select metric"),t.dimSegments=s.a.reduce(t.target.dimensions,(function(e,t,n){return e.push(r.newKey(n)),e.push(r.newOperator("=")),e.push(r.newKeyValue(t)),e}),[]),t.statSegments=s.a.map(t.target.statistics,(function(e){return r.getSegmentForValue(e)})),t.ensurePlusButton(t.statSegments),t.ensurePlusButton(t.dimSegments),t.removeDimSegment=r.newSegment({fake:!0,value:"-- remove dimension --"}),t.removeStatSegment=r.newSegment({fake:!0,value:"-- remove stat --"}),s.a.isEmpty(t.target.region)&&(t.target.region="default"),t.onChange||(t.onChange=function(){})},t.getStatSegments=function(){return Promise.resolve(s.a.flatten([a.a.copy(t.removeStatSegment),s.a.map(t.datasource.standardStatistics,(function(e){return r.getSegmentForValue(e)})),r.getSegmentForValue("pNN.NN")]))},t.statSegmentChanged=function(e,n){e.value===t.removeStatSegment.value?t.statSegments.splice(n,1):e.type="value",t.target.statistics=s.a.reduce(t.statSegments,(function(e,t){return t.fake||e.push(t.value),e}),[]),t.ensurePlusButton(t.statSegments),t.onChange()},t.ensurePlusButton=function(e){var t=e.length,n=e[Math.max(t-1,0)];n&&"plus-button"===n.type||e.push(r.newPlusButton())},t.getDimSegments=function(e,n){if("operator"===e.type)return Promise.resolve([]);var r=t.target,i=Promise.resolve([]);if("key"===e.type||"plus-button"===e.type)i=t.datasource.getDimensionKeys(t.target.namespace,t.target.region);else if("value"===e.type){var o=t.dimSegments[n-2].value;delete r.dimensions[o],i=t.datasource.getDimensionValues(r.region,r.namespace,r.metricName,o,r.dimensions)}return i.then(t.transformToSegments(!0)).then((function(n){return"key"===e.type&&n.splice(0,0,a.a.copy(t.removeDimSegment)),n}))},t.dimSegmentChanged=function(e,n){t.dimSegments[n]=e,e.value===t.removeDimSegment.value?t.dimSegments.splice(n,3):"plus-button"===e.type&&(t.dimSegments.push(r.newOperator("=")),t.dimSegments.push(r.newFake("select dimension value","value","query-segment-value")),e.type="key",e.cssClass="query-segment-key"),t.syncDimSegmentsWithModel(),t.ensurePlusButton(t.dimSegments),t.onChange()},t.syncDimSegmentsWithModel=function(){for(var e={},n=t.dimSegments.length,r=0;r<n-2;r+=3){var a=t.dimSegments[r],i=t.dimSegments[r+2];i.fake||(e[a.value]=i.value)}t.target.dimensions=e},t.getRegions=function(){return t.datasource.metricFindQuery("regions()").then((function(e){return e.unshift({text:"default"}),e})).then(t.transformToSegments(!0))},t.getNamespaces=function(){return t.datasource.metricFindQuery("namespaces()").then(t.transformToSegments(!0))},t.getMetrics=function(){return t.datasource.metricFindQuery("metrics("+t.target.namespace+","+t.target.region+")").then(t.transformToSegments(!0))},t.regionChanged=function(){t.target.region=t.regionSegment.value,t.onChange()},t.namespaceChanged=function(){t.target.namespace=t.namespaceSegment.value,t.onChange()},t.metricChanged=function(){t.target.metricName=t.metricSegment.value,t.onChange()},t.transformToSegments=function(e){return function(t){var a=s.a.map(t,(function(e){return r.newSegment({value:e.text,expandable:e.expandable})}));return e&&s.a.each(n.variables,(function(e){a.unshift(r.newSegment({type:"template",value:"$"+e.name,expandable:!0}))})),a}},t.init()};c.$inject=["$scope","templateSrv","uiSegmentSrv","datasourceSrv"],c.$inject=["$scope","templateSrv","uiSegmentSrv","datasourceSrv"],i.c.directive("cloudwatchQueryParameter",(function(){return{templateUrl:"public/app/plugins/datasource/cloudwatch/partials/query.parameter.html",controller:c,restrict:"E",scope:{target:"=",datasource:"=",onChange:"&"}}}));var u=n("Obii"),l=n("q1tI"),m=n.n(l),p=n("kDLi"),f=n("WnbS"),d=n("sGFA");function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=[{label:"Access & secret key",value:"keys"},{label:"Credentials file",value:"credentials"},{label:"ARN",value:"arn"}],E=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=y(this,b(t).call(this,e))).loadRegionsPromise=null,n.state={regions:[]},n}var n,r,a,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,e),n=t,(r=[{key:"componentDidMount",value:function(){this.loadRegionsPromise=Object(d.a)(this.loadRegions()),this.loadRegionsPromise.promise.catch((function(e){e.isCanceled&&console.warn("Cloud Watch ConfigEditor has unmounted, intialization was canceled")}))}},{key:"componentWillUnmount",value:function(){this.loadRegionsPromise&&this.loadRegionsPromise.cancel()}},{key:"loadRegions",value:(i=regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.a)().loadDatasource(this.props.options.name).then((function(e){return e.getRegions()})).then((function(e){t.setState({regions:e.map((function(e){return{value:e.value,label:e.text}}))})}),(function(e){t.setState({regions:["ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-southeast-1","ap-southeast-2","ca-central-1","cn-north-1","cn-northwest-1","eu-central-1","eu-north-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-2","us-gov-east-1","us-gov-west-1","us-iso-east-1","us-isob-east-1","us-west-1","us-west-2"].map((function(e){return{value:e,label:e}}))})}));case 2:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=i.apply(e,t);function o(e){h(a,n,r,o,s,"next",e)}function s(e){h(a,n,r,o,s,"throw",e)}o(void 0)}))},function(){return o.apply(this,arguments)})},{key:"render",value:function(){var e=this,t=this.state.regions,n=this.props.options,r=n.secureJsonData||{};return m.a.createElement(m.a.Fragment,null,m.a.createElement("h3",{className:"page-heading"},"CloudWatch Details"),m.a.createElement("div",{className:"gf-form-group"},m.a.createElement("div",{className:"gf-form-inline"},m.a.createElement("div",{className:"gf-form"},m.a.createElement(p.FormLabel,{className:"width-14"},"Auth Provider"),m.a.createElement(p.Select,{className:"width-30",value:w.find((function(e){return e.value===n.jsonData.authType})),options:w,defaultValue:n.jsonData.authType,onChange:function(t){"arn"===n.jsonData.authType&&"arn"!==t.value&&delete e.props.options.jsonData.assumeRoleArn,Object(u.onUpdateDatasourceJsonDataOptionSelect)(e.props,"authType")(t)}}))),"credentials"===n.jsonData.authType&&m.a.createElement("div",{className:"gf-form-inline"},m.a.createElement("div",{className:"gf-form"},m.a.createElement(p.FormLabel,{className:"width-14",tooltip:"Credentials profile name, as specified in ~/.aws/credentials, leave blank for default."},"Credentials Profile Name"),m.a.createElement("div",{className:"width-30"},m.a.createElement(p.Input,{className:"width-30",placeholder:"default",value:n.jsonData.database,onChange:Object(u.onUpdateDatasourceOption)(this.props,"database")})))),"keys"===n.jsonData.authType&&m.a.createElement("div",null,n.secureJsonFields.accessKey?m.a.createElement("div",{className:"gf-form-inline"},m.a.createElement("div",{className:"gf-form"},m.a.createElement(p.FormLabel,{className:"width-14"},"Access Key ID"),m.a.createElement(p.Input,{className:"width-25",placeholder:"Configured",disabled:!0})),m.a.createElement("div",{className:"gf-form"},m.a.createElement("div",{className:"max-width-30 gf-form-inline"},m.a.createElement(p.Button,{variant:"secondary",type:"button",onClick:Object(u.onUpdateDatasourceResetOption)(this.props,"accessKey")},"Reset")))):m.a.createElement("div",{className:"gf-form-inline"},m.a.createElement("div",{className:"gf-form"},m.a.createElement(p.FormLabel,{className:"width-14"},"Access Key ID"),m.a.createElement("div",{className:"width-30"},m.a.createElement(p.Input,{className:"width-30",value:r.accessKey||"",onChange:Object(u.onUpdateDatasourceSecureJsonDataOption)(this.props,"accessKey")})))),n.secureJsonFields.secretKey?m.a.createElement("div",{className:"gf-form-inline"},m.a.createElement("div",{className:"gf-form"},m.a.createElement(p.FormLabel,{className:"width-14"},"Secret Access Key"),m.a.createElement(p.Input,{className:"width-25",placeholder:"Configured",disabled:!0})),m.a.createElement("div",{className:"gf-form"},m.a.createElement("div",{className:"max-width-30 gf-form-inline"},m.a.createElement(p.Button,{variant:"secondary",type:"button",onClick:Object(u.onUpdateDatasourceResetOption)(this.props,"secretKey")},"Reset")))):m.a.createElement("div",{className:"gf-form-inline"},m.a.createElement("div",{className:"gf-form"},m.a.createElement(p.FormLabel,{className:"width-14"},"Secret Access Key"),m.a.createElement("div",{className:"width-30"},m.a.createElement(p.Input,{className:"width-30",value:r.secretKey||"",onChange:Object(u.onUpdateDatasourceSecureJsonDataOption)(this.props,"secretKey")}))))),"arn"===n.jsonData.authType&&m.a.createElement("div",{className:"gf-form-inline"},m.a.createElement("div",{className:"gf-form"},m.a.createElement(p.FormLabel,{className:"width-14",tooltip:"ARN of Assume Role"},"Assume Role ARN"),m.a.createElement("div",{className:"width-30"},m.a.createElement(p.Input,{className:"width-30",placeholder:"arn:aws:iam:*",value:n.jsonData.assumeRoleArn||"",onChange:Object(u.onUpdateDatasourceJsonDataOption)(this.props,"assumeRoleArn")})))),m.a.createElement("div",{className:"gf-form-inline"},m.a.createElement("div",{className:"gf-form"},m.a.createElement(p.FormLabel,{className:"width-14",tooltip:"Specify the region, such as for US West (Oregon) use ` us-west-2 ` as the region."},"Default Region"),m.a.createElement(p.Select,{className:"width-30",value:t.find((function(e){return e.value===n.jsonData.defaultRegion})),options:t,defaultValue:n.jsonData.defaultRegion,onChange:Object(u.onUpdateDatasourceJsonDataOptionSelect)(this.props,"defaultRegion")}))),m.a.createElement("div",{className:"gf-form-inline"},m.a.createElement("div",{className:"gf-form"},m.a.createElement(p.FormLabel,{className:"width-14",tooltip:"Namespaces of Custom Metrics."},"Custom Metrics"),m.a.createElement(p.Input,{className:"width-30",placeholder:"Namespace1,Namespace2",value:n.jsonData.customMetricsNamespaces||"",onChange:Object(u.onUpdateDatasourceJsonDataOption)(this.props,"customMetricsNamespaces")})))))}}])&&v(n.prototype,r),a&&v(n,a),t}(l.PureComponent),O=n("bY+8");function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t){return!t||"object"!==N(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var M=A({},p.EventsWithValidation.onBlur,[{rule:function(e){return new RegExp(/^$|^[a-z][a-zA-Z0-9_]*$/).test(e)},errorMessage:"Invalid format. Only alphanumeric characters and underscores are allowed"}]),I=function(e){function t(){var e,n;k(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=P(this,(e=R(t)).call.apply(e,[this].concat(a)))).state={showMeta:!1},n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,e),n=t,a=[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.query;return n.namespace||(n.namespace=""),n.metricName||(n.metricName=""),n.expression||(n.expression=""),n.dimensions||(n.dimensions={}),n.region||(n.region="default"),n.id||(n.id=""),n.alias||(n.alias=""),n.statistics&&n.statistics.length||(n.statistics=["Average"]),n.hasOwnProperty("matchExact")||(n.matchExact=!0),t}}],(r=[{key:"onChange",value:function(e){var t=this.props,n=t.onChange,r=t.onRunQuery;n(e),r()}},{key:"render",value:function(){var e=this,t=this.props,n=t.data,r=t.query,a=t.onRunQuery,i=this.state.showMeta,o=n&&Object.values(n).length&&"Done"===n.state;return m.a.createElement(m.a.Fragment,null,m.a.createElement(O.d,this.props),r.statistics.length<=1&&m.a.createElement("div",{className:"gf-form-inline"},m.a.createElement("div",{className:"gf-form"},m.a.createElement(O.c,{label:"Id",tooltip:"Id can include numbers, letters, and underscore, and must start with a lowercase letter."},m.a.createElement(p.Input,{className:"gf-form-input width-8",onBlur:a,onChange:function(t){return e.onChange(j({},r,{id:t.target.value}))},validationEvents:M,value:r.id||""}))),m.a.createElement("div",{className:"gf-form gf-form--grow"},m.a.createElement(O.c,{className:"gf-form--grow",label:"Expression",tooltip:"Optionally you can add an expression here. Please note that if a math expression that is referencing other queries is being used, it will not be possible to create an alert rule based on this query"},m.a.createElement(p.Input,{className:"gf-form-input",onBlur:a,value:r.expression||"",onChange:function(t){return e.onChange(j({},r,{expression:t.target.value}))}})))),m.a.createElement("div",{className:"gf-form-inline"},m.a.createElement("div",{className:"gf-form"},m.a.createElement(O.c,{label:"Period",tooltip:"Minimum interval between points in seconds"},m.a.createElement(p.Input,{className:"gf-form-input width-8",value:r.period||"",placeholder:"auto",onBlur:a,onChange:function(t){return e.onChange(j({},r,{period:t.target.value}))}}))),m.a.createElement("div",{className:"gf-form"},m.a.createElement(O.c,{label:"Alias",tooltip:"Alias replacement variables: {{metric}}, {{stat}}, {{namespace}}, {{region}}, {{period}}, {{label}}, {{YOUR_DIMENSION_NAME}}"},m.a.createElement(O.a,{value:r.alias,onChange:function(t){return e.onChange(j({},r,{alias:t}))}})),m.a.createElement(p.Switch,{label:"Match Exact",labelClass:"query-keyword",tooltip:"Only show metrics that exactly match all defined dimension names.",checked:r.matchExact,onChange:function(){return e.onChange(j({},r,{matchExact:!r.matchExact}))}}),m.a.createElement("label",{className:"gf-form-label"},m.a.createElement("a",{onClick:function(){return o&&e.setState({showMeta:!i})}},m.a.createElement("i",{className:"fa fa-caret-".concat(i?"down":"right")})," ",i?"Hide":"Show"," Query Preview"))),m.a.createElement("div",{className:"gf-form gf-form--grow"},m.a.createElement("div",{className:"gf-form-label gf-form-label--grow"})),i&&o&&m.a.createElement("table",{className:"filter-table form-inline"},m.a.createElement("thead",null,m.a.createElement("tr",null,m.a.createElement("th",null,"Metric Data Query ID"),m.a.createElement("th",null,"Metric Data Query Expression"),m.a.createElement("th",null,"Period"),m.a.createElement("th",null))),m.a.createElement("tbody",null,n.series[0].meta.gmdMeta.map((function(e){var t=e.ID,n=e.Expression,r=e.Period;return m.a.createElement("tr",{key:t},m.a.createElement("td",null,t),m.a.createElement("td",null,n),m.a.createElement("td",null,r))}))))))}}])&&D(n.prototype,r),a&&D(n,a),t}(l.PureComponent),_=n("3SGO"),q=n("UvM7"),F=n("GQ3c"),Q=n("iODs"),T=n("PbtU"),V=n("t8hP"),U=function(e){var t=e.region;return m.a.createElement("p",null,"Please visit the ",m.a.createElement("a",{target:"_blank",className:"text-link",href:"https://".concat(t,".console.aws.amazon.com/servicequotas/home?region=").concat(t,"#!/services/monitoring/quotas/L-5E141212")},"AWS Service Quotas console")," to request a quota increase or see our ",m.a.createElement("a",{target:"_blank",className:"text-link",href:"https://grafana.com/docs/features/datasources/cloudwatch/#service-quotas"},"documentation")," to learn more.")},K=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7e3,n=Object(o.memoize)((function(){return Object(o.debounce)(e,t,{leading:!0})}),(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return JSON.stringify(t)}));return function(){return n.apply(void 0,arguments).apply(void 0,arguments)}};function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function W(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){B(i,r,a,o,s,"next",e)}function s(e){B(i,r,a,o,s,"throw",e)}o(void 0)}))}}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function $(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){H(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t){return!t||"object"!==J(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var te=function(e,t){return Q.d.dispatch(Object(_.b)(Object(q.a)("CloudWatch request limit reached in ".concat(t," for data source ").concat(e),"",m.a.createElement(U,{region:t},null))))},ne=function(e,t){return Q.d.dispatch(Object(_.b)(Object(q.a)(e,t)))},re=function(e){function t(e,n,r){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=Z(this,X(t).call(this,e))).templateSrv=n,a.timeSrv=r,a.type="cloudwatch",a.proxyUrl=e.url,a.defaultRegion=e.jsonData.defaultRegion,a.datasourceName=e.name,a.standardStatistics=["Average","Maximum","Minimum","Sum","SampleCount"],a.debouncedAlert=K(te,F.AppNotificationTimeout.Error),a.debouncedCustomAlert=K(ne,F.AppNotificationTimeout.Error),a}var n,r,i,o,c,l,m;return t.$inject=["instanceSettings","templateSrv","timeSrv"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}(t,e),n=t,(r=[{key:"query",value:function(e){var t=this;e=a.a.copy(e);var n=s.a.filter(e.targets,(function(e){return(""!==e.id||!0!==e.hide)&&(!!e.region&&!!e.namespace&&!!e.metricName&&!s.a.isEmpty(e.statistics)||e.expression.length>0)})).map((function(n){if(n.region=t.replace(t.getActualRegion(n.region),e.scopedVars,!0,"region"),n.namespace=t.replace(n.namespace,e.scopedVars,!0,"namespace"),n.metricName=t.replace(n.metricName,e.scopedVars,!0,"metric name"),n.dimensions=t.convertDimensionFormat(n.dimensions,e.scopedVars),n.statistics=n.statistics.map((function(n){return t.replace(n,e.scopedVars,!0,"statistics")})),n.period=String(t.getPeriod(n,e)),n.id=t.templateSrv.replace(n.id,e.scopedVars),n.expression=t.templateSrv.replace(n.expression,e.scopedVars),n.statistics.some((function(e){if(0===e.indexOf("p")){var t=/^p\d{2}(?:\.\d{1,2})?$/.exec(e);return!t||t[0]!==e}return!1})))throw{message:"Invalid extended statistics"};return s.a.extend({refId:n.refId,intervalMs:e.intervalMs,maxDataPoints:e.maxDataPoints,datasourceId:t.id,type:"timeSeriesQuery"},n)}));if(s.a.isEmpty(n))return Promise.resolve({data:[]});var r={from:e.range.from.valueOf().toString(),to:e.range.to.valueOf().toString(),queries:n};return this.performTimeSeriesQuery(r,e.range)}},{key:"getPeriod",value:function(e,t){var n=this.templateSrv.replace(e.period,t.scopedVars);return n&&"auto"!==n.toLowerCase()&&(n=/^\d+$/.test(n)?parseInt(n,10):T.a.interval_to_seconds(n))<1&&(n=1),n||""}},{key:"buildCloudwatchConsoleUrl",value:function(e,t,n,r,a){var i=e.region,o=e.namespace,s=e.metricName,c=e.dimensions,u=e.statistics,l=e.expression,m={view:"timeSeries",stacked:!1,title:r,start:t,end:n,region:i=this.getActualRegion(i)},p=a&&a.length&&a.every((function(e){var t=e.Expression;return/SEARCH().*/.test(t)}));return!p&&l?"":(m=G({},m,p?{metrics:a&&a.length?a.map((function(e){return{expression:e.Expression}})):[{expression:l}]}:{metrics:$(u.map((function(e){return[o,s].concat($(Object.entries(c).reduce((function(e,t){var n=L(t,2),r=n[0],a=n[1];return[].concat($(e),[r,a[0]])}),[])),[{stat:e,period:a.length?a[0].Period:60}])})))}),"https://".concat(i,".console.aws.amazon.com/cloudwatch/deeplink.js?region=").concat(i,"#metricsV2:graph=").concat(encodeURIComponent(JSON.stringify(m))))}},{key:"performTimeSeriesQuery",value:function(e,t){var n=this,r=t.from,a=t.to;return this.awsRequest("/api/tsdb/query",e).then((function(t){return t.results?Object.values(e.queries).reduce((function(e,i){var o=e.data,s=e.error,c=t.results[i.refId];if(!c)return{data:o,error:s};var l=n.buildCloudwatchConsoleUrl(i,r.toISOString(),a.toISOString(),i.refId,c.meta.gmdMeta);return{error:s||c.error?{message:c.error}:null,data:[].concat($(o),$(c.series.map((function(e){var t=e.name,n=e.points,r=Object(u.toDataFrame)({target:t,datapoints:n,refId:i.refId,meta:c.meta});if(l){var a=!0,o=!1,s=void 0;try{for(var m,p=r.fields[Symbol.iterator]();!(a=(m=p.next()).done);a=!0)m.value.config.links=[{url:l,title:"View in CloudWatch console",targetBlank:!0}]}catch(e){o=!0,s=e}finally{try{a||null==p.return||p.return()}finally{if(o)throw s}}}return r}))))}}),{data:[],error:null}):{data:[]}})).catch((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{data:{error:""}};if(/^Throttling:.*/.test(t.data.message)){var r=Object.keys(t.data.results),a=Object.values(e.queries).reduce((function(e,t){var n=t.refId,a=t.region;return!r.includes(n)||e.includes(a)?e:[].concat($(e),[a])}),[]);a.forEach((function(e){return n.debouncedAlert(n.datasourceName,n.getActualRegion(e))}))}throw t.data&&"Metric request error"===t.data.message&&t.data.error&&(t.data.message=t.data.error),t}))}},{key:"transformSuggestDataFromTable",value:function(e){return s.a.map(e.results.metricFindQuery.tables[0].rows,(function(e){return{text:e[0],value:e[1],label:e[1]}}))}},{key:"doMetricQueryRequest",value:function(e,t){var n=this,r=this.timeSrv.timeRange();return this.awsRequest("/api/tsdb/query",{from:r.from.valueOf().toString(),to:r.to.valueOf().toString(),queries:[s.a.extend({refId:"metricFindQuery",intervalMs:1,maxDataPoints:1,datasourceId:this.id,type:"metricFindQuery",subtype:e},t)]}).then((function(e){return n.transformSuggestDataFromTable(e)}))}},{key:"getRegions",value:function(){return this.doMetricQueryRequest("regions",null).then((function(e){return[{label:"default",value:"default",text:"default"}].concat($(e))}))}},{key:"getNamespaces",value:function(){return this.doMetricQueryRequest("namespaces",null)}},{key:"getMetrics",value:(m=W(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:return e.abrupt("return",this.doMetricQueryRequest("metrics",{region:this.templateSrv.replace(this.getActualRegion(n)),namespace:this.templateSrv.replace(t)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"getDimensionKeys",value:(l=W(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:return e.abrupt("return",this.doMetricQueryRequest("dimension_keys",{region:this.templateSrv.replace(this.getActualRegion(n)),namespace:this.templateSrv.replace(t)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"getDimensionValues",value:(c=W(regeneratorRuntime.mark((function e(t,n,r,a,i){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&r){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.doMetricQueryRequest("dimension_values",{region:this.templateSrv.replace(this.getActualRegion(t)),namespace:this.templateSrv.replace(n),metricName:this.templateSrv.replace(r.trim()),dimensionKey:this.templateSrv.replace(a),dimensions:this.convertDimensionFormat(i,{})});case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,a){return c.apply(this,arguments)})},{key:"getEbsVolumeIds",value:function(e,t){return this.doMetricQueryRequest("ebs_volume_ids",{region:this.templateSrv.replace(this.getActualRegion(e)),instanceId:this.templateSrv.replace(t)})}},{key:"getEc2InstanceAttribute",value:function(e,t,n){return this.doMetricQueryRequest("ec2_instance_attribute",{region:this.templateSrv.replace(this.getActualRegion(e)),attributeName:this.templateSrv.replace(t),filters:n})}},{key:"getResourceARNs",value:function(e,t,n){return this.doMetricQueryRequest("resource_arns",{region:this.templateSrv.replace(this.getActualRegion(e)),resourceType:this.templateSrv.replace(t),tags:n})}},{key:"metricFindQuery",value:(o=W(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,c,u,l,m,p,f,d,g,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.match(/^regions\(\)/)){e.next=3;break}return e.abrupt("return",this.getRegions());case 3:if(!t.match(/^namespaces\(\)/)){e.next=6;break}return e.abrupt("return",this.getNamespaces());case 6:if(!(o=t.match(/^metrics\(([^\)]+?)(,\s?([^,]+?))?\)/))){e.next=11;break}return r=o[1],n=o[3],e.abrupt("return",this.getMetrics(r,n));case 11:if(!(s=t.match(/^dimension_keys\(([^\)]+?)(,\s?([^,]+?))?\)/))){e.next=16;break}return r=s[1],n=s[3],e.abrupt("return",this.getDimensionKeys(r,n));case 16:if(!(c=t.match(/^dimension_values\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)(,\s?(.+))?\)/))){e.next=25;break}return n=c[1],r=c[2],a=c[3],u=c[4],i={},c[6]&&(i=JSON.parse(this.templateSrv.replace(c[6]))),e.abrupt("return",this.getDimensionValues(n,r,a,u,i));case 25:if(!(l=t.match(/^ebs_volume_ids\(([^,]+?),\s?([^,]+?)\)/))){e.next=30;break}return n=l[1],m=l[2],e.abrupt("return",this.getEbsVolumeIds(n,m));case 30:if(!(p=t.match(/^ec2_instance_attribute\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/))){e.next=36;break}return n=p[1],f=p[2],i=JSON.parse(this.templateSrv.replace(p[3])),e.abrupt("return",this.getEc2InstanceAttribute(n,f,i));case 36:if(!(d=t.match(/^resource_arns\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/))){e.next=42;break}return n=d[1],g=d[2],h=JSON.parse(this.templateSrv.replace(d[3])),e.abrupt("return",this.getResourceARNs(n,g,h));case 42:if(!t.match(/^statistics\(\)/)){e.next=45;break}return e.abrupt("return",this.standardStatistics.map((function(e){return{value:e,label:e,text:e}})));case 45:return e.abrupt("return",Promise.resolve([]));case 46:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"annotationQuery",value:function(e){var t=this,n=e.annotation,r=s.a.map(n.statistics,(function(e){return t.templateSrv.replace(e)})),a=n.prefixMatching?"":"300",i=n.period||a;i=parseInt(i,10);var o={prefixMatching:n.prefixMatching,region:this.templateSrv.replace(this.getActualRegion(n.region)),namespace:this.templateSrv.replace(n.namespace),metricName:this.templateSrv.replace(n.metricName),dimensions:this.convertDimensionFormat(n.dimensions,{}),statistics:r,period:i,actionPrefix:n.actionPrefix||"",alarmNamePrefix:n.alarmNamePrefix||""};return this.awsRequest("/api/tsdb/query",{from:e.range.from.valueOf().toString(),to:e.range.to.valueOf().toString(),queries:[s.a.extend({refId:"annotationQuery",intervalMs:1,maxDataPoints:1,datasourceId:this.id,type:"annotationQuery"},o)]}).then((function(e){return s.a.map(e.results.annotationQuery.tables[0].rows,(function(e){return{annotation:n,time:Date.parse(e[0]),title:e[1],tags:[e[2]],text:e[3]}}))}))}},{key:"targetContainsTemplate",value:function(e){var t=this;return this.templateSrv.variableExists(e.region)||this.templateSrv.variableExists(e.namespace)||this.templateSrv.variableExists(e.metricName)||s.a.find(e.dimensions,(function(e,n){return t.templateSrv.variableExists(n)||t.templateSrv.variableExists(e)}))}},{key:"testDatasource",value:function(){var e=this.defaultRegion;return this.getDimensionValues(e,"AWS/Billing","EstimatedCharges","ServiceName",{}).then((function(){return{status:"success",message:"Data source is working"}}))}},{key:"awsRequest",value:function(e,t){var n={method:"POST",url:e,data:t};return Object(V.getBackendSrv)().datasourceRequest(n).then((function(e){return e.data}))}},{key:"getDefaultRegion",value:function(){return this.defaultRegion}},{key:"getActualRegion",value:function(e){return"default"===e||s.a.isEmpty(e)?this.getDefaultRegion():e}},{key:"convertToCloudWatchTime",value:function(e,t){return s.a.isString(e)&&(e=u.dateMath.parse(e,t)),Math.round(e.valueOf()/1e3)}},{key:"convertDimensionFormat",value:function(e,t){var n=this;return Object.entries(e).reduce((function(e,r){var a=L(r,2),i=a[0],o=a[1];if(i=n.replace(i,t,!0,"dimension keys"),Array.isArray(o))return G({},e,H({},i,o));var s=n.templateSrv.variables.find((function(e){return e.name===n.templateSrv.getVariableName(o)}));return s?s.multi?G({},e,H({},i,n.templateSrv.replace(o,t,"pipe").split("|"))):G({},e,H({},i,[n.templateSrv.replace(o,t)])):G({},e,H({},i,[o]))}),{})}},{key:"replace",value:function(e,t,n,r){var a=this;if(n){var i=this.templateSrv.variables.find((function(t){return t.name===a.templateSrv.getVariableName(e)}));i&&i.multi&&this.debouncedCustomAlert("CloudWatch templating error","Multi template variables are not supported for ".concat(r||e))}return this.templateSrv.replace(e,t)}},{key:"variables",get:function(){return this.templateSrv.variables.map((function(e){return"$".concat(e.name)}))}}])&&Y(n.prototype,r),i&&Y(n,i),t}(u.DataSourceApi);function ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ie=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s.a.defaultsDeep(this.annotation,{namespace:"",metricName:"",expression:"",dimensions:{},region:"default",id:"",alias:"",statistics:["Average"],matchExact:!0,prefixMatching:!1,actionPrefix:"",alarmNamePrefix:""}),this.onChange=this.onChange.bind(this)}var t,n,r;return t=e,(n=[{key:"onChange",value:function(e){Object.assign(this.annotation,e)}}])&&ae(t.prototype,n),r&&ae(t,r),e}();ie.templateUrl="partials/annotations.editor.html",n.d(t,"plugin",(function(){return oe}));var oe=new u.DataSourcePlugin(re).setConfigEditor(E).setQueryEditor(I).setExploreQueryField(I).setAnnotationQueryCtrl(ie)},sGFA:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){var t=!1;return{promise:new Promise((function(n,r){e.then((function(e){return t?r({isCanceled:!0}):n(e)})),e.catch((function(e){return r(t?{isCanceled:!0}:e)}))})),cancel:function(){t=!0}}}}}]);
//# sourceMappingURL=cloudwatchPlugin.898fe9e20a782b4232fe.js.map