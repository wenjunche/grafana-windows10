{"version":3,"sources":["webpack:///./public/app/plugins/datasource/testdata/metricTree.ts","webpack:///./public/app/plugins/datasource/testdata/LogIpsum.ts","webpack:///./public/app/plugins/datasource/testdata/runStreams.ts","webpack:///./public/app/plugins/datasource/testdata/datasource.ts","webpack:///./public/app/plugins/datasource/testdata/query_ctrl.ts","webpack:///./public/app/plugins/datasource/testdata/TestInfoTab.tsx","webpack:///./public/app/plugins/datasource/testdata/ConfigEditor.tsx","webpack:///./public/app/plugins/datasource/testdata/module.tsx"],"names":["queryMetricTree","query","queryTree","children","queryIndex","length","nodeQuery","result","namesToMatch","startsWith","replace","split","node","nameToMatch","indexOf","pattern","RegExp","test","name","concat","buildMetricTree","parent","depth","letter","nodeName","push","index","getNextWord","Math","floor","random","words","defaultQuery","type","speed","spread","noise","bands","runStream","target","req","defaults","stream","Observable","subscriber","streamId","panelId","refId","maxDataPoints","data","CircularDataFrame","append","capacity","alias","addField","FieldType","time","number","i","suffix","value","timeoutId","addNextRow","idx","fields","values","add","min","max","Date","now","setTimeout","pushNextEvent","next","key","console","log","clearTimeout","runSignalStream","string","line","getRandomLine","runLogsStream","reader","csv","CSVReader","callback","onHeader","field","onRow","row","processChunk","text","TextDecoder","decode","readCSV","state","done","LoadingState","Done","Streaming","complete","read","then","fetch","Request","url","response","body","getReader","runFetchStream","Error","TestDataDataSource","instanceSettings","options","queries","streams","targets","hide","scenarioId","intervalMs","datasourceId","this","id","templateSrv","getBackendSrv","datasourceRequest","method","from","range","valueOf","toString","to","requestId","res","processQueryResult","merge","error","undefined","results","tables","table","series","datapoints","points","tags","message","timeWalker","events","step","annotation","Promise","resolve","status","get","reject","items","getSearchFilterScopedVar","wildcardChar","map","item","DataSourceApi","defaultPulse","timeStep","onCount","onValue","offCount","offValue","defaultCSVWave","valuesCSV","showLabelsFor","TestDataQueryCtrl","$scope","$injector","showLabels","scenarioList","newPointTime","dateTime","selectedPoint","includes","selectors","e2e","pages","Dashboard","Panels","DataSource","TestData","QueryTab","_","point","format","option","splice","refresh","dateMath","parse","newPointValue","sortBy","p","promiseToDigest","scenario","find","stringInput","pulseWave","csvWave","QueryCtrl","templateUrl","TestInfoTab","props","className","href","rel","PureComponent","ConfigEditor","TestDataAnnotationsQueryCtrl","template","plugin","DataSourcePlugin","setConfigEditor","setQueryCtrl","setAnnotationQueryCtrl","addConfigPage","title","icon"],"mappings":"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","file":"testDataDSPlugin.898fe9e20a782b4232fe.js","sourcesContent":["export interface TreeNode {\n  name: string;\n  children: TreeNode[];\n}\n\n/*\n *  Builds a nested tree like\n *  [\n *    {\n *      name: 'A',\n *      children: [\n *        { name: 'AA', children: [] },\n *        { name: 'AB', children: [] },\n *      ]\n *    }\n *  ]\n */\nfunction buildMetricTree(parent: string, depth: number): TreeNode[] {\n  const chars = ['A', 'B', 'C'];\n  const children: TreeNode[] = [];\n\n  if (depth > 3) {\n    return [];\n  }\n\n  for (const letter of chars) {\n    const nodeName = `${parent}${letter}`;\n    children.push({\n      name: nodeName,\n      children: buildMetricTree(nodeName, depth + 1),\n    });\n  }\n\n  return children;\n}\n\nfunction queryTree(children: TreeNode[], query: string[], queryIndex: number): TreeNode[] {\n  if (queryIndex >= query.length) {\n    return children;\n  }\n\n  if (query[queryIndex] === '*') {\n    return children;\n  }\n\n  const nodeQuery = query[queryIndex];\n  let result: TreeNode[] = [];\n  let namesToMatch = [nodeQuery];\n\n  // handle glob queries\n  if (nodeQuery.startsWith('{')) {\n    namesToMatch = nodeQuery.replace(/\\{|\\}/g, '').split(',');\n  }\n\n  for (const node of children) {\n    for (const nameToMatch of namesToMatch) {\n      if (nameToMatch.indexOf('*') !== -1) {\n        const pattern = nameToMatch.replace('*', '');\n        const regex = new RegExp(`^${pattern}.*`, 'gi');\n        if (regex.test(node.name)) {\n          result = result.concat(queryTree([node], query, queryIndex + 1));\n        }\n      } else if (node.name === nameToMatch) {\n        result = result.concat(queryTree(node.children, query, queryIndex + 1));\n      }\n    }\n  }\n\n  return result;\n}\n\nexport function queryMetricTree(query: string): TreeNode[] {\n  const children = buildMetricTree('', 0);\n  return queryTree(children, query.split('.'), 0);\n}\n","import { LogLevel } from '@grafana/data';\n\nlet index = 0;\n\nexport function getRandomLogLevel(): LogLevel {\n  const v = Math.random();\n  if (v > 0.9) {\n    return LogLevel.critical;\n  }\n  if (v > 0.8) {\n    return LogLevel.error;\n  }\n  if (v > 0.7) {\n    return LogLevel.warning;\n  }\n  if (v > 0.4) {\n    return LogLevel.info;\n  }\n  if (v > 0.3) {\n    return LogLevel.debug;\n  }\n  if (v > 0.1) {\n    return LogLevel.trace;\n  }\n  return LogLevel.unknown;\n}\n\nexport function getNextWord() {\n  index = (index + Math.floor(Math.random() * 5)) % words.length;\n  return words[index];\n}\n\nexport function getRandomLine(length = 60) {\n  let line = getNextWord();\n  while (line.length < length) {\n    line += ' ' + getNextWord();\n  }\n  return line;\n}\n\nconst words = [\n  'At',\n  'vero',\n  'eos',\n  'et',\n  'accusamus',\n  'et',\n  'iusto',\n  'odio',\n  'dignissimos',\n  'ducimus',\n  'qui',\n  'blanditiis',\n  'praesentium',\n  'voluptatum',\n  'deleniti',\n  'atque',\n  'corrupti',\n  'quos',\n  'dolores',\n  'et',\n  'quas',\n  'molestias',\n  'excepturi',\n  'sint',\n  'occaecati',\n  'cupiditate',\n  'non',\n  'provident',\n  'similique',\n  'sunt',\n  'in',\n  'culpa',\n  'qui',\n  'officia',\n  'deserunt',\n  'mollitia',\n  'animi',\n  'id',\n  'est',\n  'laborum',\n  'et',\n  'dolorum',\n  'fuga',\n  'Et',\n  'harum',\n  'quidem',\n  'rerum',\n  'facilis',\n  'est',\n  'et',\n  'expedita',\n  'distinctio',\n  'Nam',\n  'libero',\n  'tempore',\n  'cum',\n  'soluta',\n  'nobis',\n  'est',\n  'eligendi',\n  'optio',\n  'cumque',\n  'nihil',\n  'impedit',\n  'quo',\n  'minus',\n  'id',\n  'quod',\n  'maxime',\n  'placeat',\n  'facere',\n  'possimus',\n  'omnis',\n  'voluptas',\n  'assumenda',\n  'est',\n  'omnis',\n  'dolor',\n  'repellendus',\n  'Temporibus',\n  'autem',\n  'quibusdam',\n  'et',\n  'aut',\n  'officiis',\n  'debitis',\n  'aut',\n  'rerum',\n  'necessitatibus',\n  'saepe',\n  'eveniet',\n  'ut',\n  'et',\n  'voluptates',\n  'repudiandae',\n  'sint',\n  'et',\n  'molestiae',\n  'non',\n  'recusandae',\n  'Itaque',\n  'earum',\n  'rerum',\n  'hic',\n  'tenetur',\n  'a',\n  'sapiente',\n  'delectus',\n  'ut',\n  'aut',\n  'reiciendis',\n  'voluptatibus',\n  'maiores',\n  'alias',\n  'consequatur',\n  'aut',\n  'perferendis',\n  'doloribus',\n  'asperiores',\n  'repellat',\n];\n","import { defaults } from 'lodash';\nimport { Observable } from 'rxjs';\n\nimport {\n  DataQueryRequest,\n  DataQueryResponse,\n  FieldType,\n  CircularDataFrame,\n  CSVReader,\n  Field,\n  LoadingState,\n} from '@grafana/data';\n\nimport { TestDataQuery, StreamingQuery } from './types';\nimport { getRandomLine } from './LogIpsum';\n\nexport const defaultQuery: StreamingQuery = {\n  type: 'signal',\n  speed: 250, // ms\n  spread: 3.5,\n  noise: 2.2,\n  bands: 1,\n};\n\nexport function runStream(target: TestDataQuery, req: DataQueryRequest<TestDataQuery>): Observable<DataQueryResponse> {\n  const query = defaults(target.stream, defaultQuery);\n  if ('signal' === query.type) {\n    return runSignalStream(target, query, req);\n  }\n  if ('logs' === query.type) {\n    return runLogsStream(target, query, req);\n  }\n  if ('fetch' === query.type) {\n    return runFetchStream(target, query, req);\n  }\n  throw new Error(`Unknown Stream Type: ${query.type}`);\n}\n\nexport function runSignalStream(\n  target: TestDataQuery,\n  query: StreamingQuery,\n  req: DataQueryRequest<TestDataQuery>\n): Observable<DataQueryResponse> {\n  return new Observable<DataQueryResponse>(subscriber => {\n    const streamId = `signal-${req.panelId}-${target.refId}`;\n    const maxDataPoints = req.maxDataPoints || 1000;\n\n    const data = new CircularDataFrame({\n      append: 'tail',\n      capacity: maxDataPoints,\n    });\n    data.refId = target.refId;\n    data.name = target.alias || 'Signal ' + target.refId;\n    data.addField({ name: 'time', type: FieldType.time });\n    data.addField({ name: 'value', type: FieldType.number });\n\n    const { spread, speed, bands, noise } = query;\n\n    for (let i = 0; i < bands; i++) {\n      const suffix = bands > 1 ? ` ${i + 1}` : '';\n      data.addField({ name: 'Min' + suffix, type: FieldType.number });\n      data.addField({ name: 'Max' + suffix, type: FieldType.number });\n    }\n\n    let value = Math.random() * 100;\n    let timeoutId: any = null;\n\n    const addNextRow = (time: number) => {\n      value += (Math.random() - 0.5) * spread;\n\n      let idx = 0;\n      data.fields[idx++].values.add(time);\n      data.fields[idx++].values.add(value);\n\n      let min = value;\n      let max = value;\n\n      for (let i = 0; i < bands; i++) {\n        min = min - Math.random() * noise;\n        max = max + Math.random() * noise;\n\n        data.fields[idx++].values.add(min);\n        data.fields[idx++].values.add(max);\n      }\n    };\n\n    // Fill the buffer on init\n    if (true) {\n      let time = Date.now() - maxDataPoints * speed;\n      for (let i = 0; i < maxDataPoints; i++) {\n        addNextRow(time);\n        time += speed;\n      }\n    }\n\n    const pushNextEvent = () => {\n      addNextRow(Date.now());\n      subscriber.next({\n        data: [data],\n        key: streamId,\n      });\n\n      timeoutId = setTimeout(pushNextEvent, speed);\n    };\n\n    // Send first event in 5ms\n    setTimeout(pushNextEvent, 5);\n\n    return () => {\n      console.log('unsubscribing to stream ' + streamId);\n      clearTimeout(timeoutId);\n    };\n  });\n}\n\nexport function runLogsStream(\n  target: TestDataQuery,\n  query: StreamingQuery,\n  req: DataQueryRequest<TestDataQuery>\n): Observable<DataQueryResponse> {\n  return new Observable<DataQueryResponse>(subscriber => {\n    const streamId = `logs-${req.panelId}-${target.refId}`;\n    const maxDataPoints = req.maxDataPoints || 1000;\n\n    const data = new CircularDataFrame({\n      append: 'tail',\n      capacity: maxDataPoints,\n    });\n    data.refId = target.refId;\n    data.name = target.alias || 'Logs ' + target.refId;\n    data.addField({ name: 'time', type: FieldType.time });\n    data.addField({ name: 'line', type: FieldType.string });\n\n    const { speed } = query;\n\n    let timeoutId: any = null;\n\n    const pushNextEvent = () => {\n      data.values.time.add(Date.now());\n      data.values.line.add(getRandomLine());\n\n      subscriber.next({\n        data: [data],\n        key: streamId,\n      });\n\n      timeoutId = setTimeout(pushNextEvent, speed);\n    };\n\n    // Send first event in 5ms\n    setTimeout(pushNextEvent, 5);\n\n    return () => {\n      console.log('unsubscribing to stream ' + streamId);\n      clearTimeout(timeoutId);\n    };\n  });\n}\n\nexport function runFetchStream(\n  target: TestDataQuery,\n  query: StreamingQuery,\n  req: DataQueryRequest<TestDataQuery>\n): Observable<DataQueryResponse> {\n  return new Observable<DataQueryResponse>(subscriber => {\n    const streamId = `fetch-${req.panelId}-${target.refId}`;\n    const maxDataPoints = req.maxDataPoints || 1000;\n\n    let data = new CircularDataFrame({\n      append: 'tail',\n      capacity: maxDataPoints,\n    });\n    data.refId = target.refId;\n    data.name = target.alias || 'Fetch ' + target.refId;\n\n    let reader: ReadableStreamReader<Uint8Array>;\n    const csv = new CSVReader({\n      callback: {\n        onHeader: (fields: Field[]) => {\n          // Clear any existing fields\n          if (data.fields.length) {\n            data = new CircularDataFrame({\n              append: 'tail',\n              capacity: maxDataPoints,\n            });\n            data.refId = target.refId;\n            data.name = 'Fetch ' + target.refId;\n          }\n          for (const field of fields) {\n            data.addField(field);\n          }\n        },\n        onRow: (row: any[]) => {\n          data.add(row);\n        },\n      },\n    });\n\n    const processChunk = (value: ReadableStreamReadResult<Uint8Array>): any => {\n      if (value.value) {\n        const text = new TextDecoder().decode(value.value);\n        csv.readCSV(text);\n      }\n\n      subscriber.next({\n        data: [data],\n        key: streamId,\n        state: value.done ? LoadingState.Done : LoadingState.Streaming,\n      });\n\n      if (value.done) {\n        console.log('Finished stream');\n        subscriber.complete(); // necessary?\n        return;\n      }\n\n      return reader.read().then(processChunk);\n    };\n\n    fetch(new Request(query.url)).then(response => {\n      reader = response.body.getReader();\n      reader.read().then(processChunk);\n    });\n\n    return () => {\n      // Cancel fetch?\n      console.log('unsubscribing to stream ' + streamId);\n    };\n  });\n}\n","import {\n  DataQueryRequest,\n  DataQueryResponse,\n  DataSourceApi,\n  DataSourceInstanceSettings,\n  MetricFindValue,\n  TableData,\n  TimeSeries,\n  DataQueryError,\n} from '@grafana/data';\nimport { Scenario, TestDataQuery } from './types';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { queryMetricTree } from './metricTree';\nimport { from, merge, Observable } from 'rxjs';\nimport { runStream } from './runStreams';\nimport templateSrv from 'app/features/templating/template_srv';\nimport { getSearchFilterScopedVar } from '../../../features/templating/variable';\n\ntype TestData = TimeSeries | TableData;\n\nexport class TestDataDataSource extends DataSourceApi<TestDataQuery> {\n  constructor(instanceSettings: DataSourceInstanceSettings) {\n    super(instanceSettings);\n  }\n\n  query(options: DataQueryRequest<TestDataQuery>): Observable<DataQueryResponse> {\n    const queries: any[] = [];\n    const streams: Array<Observable<DataQueryResponse>> = [];\n\n    // Start streams and prepare queries\n    for (const target of options.targets) {\n      if (target.hide) {\n        continue;\n      }\n      if (target.scenarioId === 'streaming_client') {\n        streams.push(runStream(target, options));\n      } else {\n        queries.push({\n          ...target,\n          intervalMs: options.intervalMs,\n          maxDataPoints: options.maxDataPoints,\n          datasourceId: this.id,\n          alias: templateSrv.replace(target.alias || ''),\n        });\n      }\n    }\n\n    if (queries.length) {\n      const req: Promise<DataQueryResponse> = getBackendSrv()\n        .datasourceRequest({\n          method: 'POST',\n          url: '/api/tsdb/query',\n          data: {\n            from: options.range.from.valueOf().toString(),\n            to: options.range.to.valueOf().toString(),\n            queries: queries,\n          },\n          // This sets up a cancel token\n          requestId: options.requestId,\n        })\n        .then((res: any) => this.processQueryResult(queries, res));\n\n      streams.push(from(req));\n    }\n\n    return merge(...streams);\n  }\n\n  processQueryResult(queries: any, res: any): DataQueryResponse {\n    const data: TestData[] = [];\n    let error: DataQueryError | undefined = undefined;\n\n    for (const query of queries) {\n      const results = res.data.results[query.refId];\n\n      for (const t of results.tables || []) {\n        const table = t as TableData;\n        table.refId = query.refId;\n        table.name = query.alias;\n        data.push(table);\n      }\n\n      for (const series of results.series || []) {\n        data.push({ target: series.name, datapoints: series.points, refId: query.refId, tags: series.tags });\n      }\n\n      if (results.error) {\n        error = {\n          message: results.error,\n        };\n      }\n    }\n\n    return { data, error };\n  }\n\n  annotationQuery(options: any) {\n    let timeWalker = options.range.from.valueOf();\n    const to = options.range.to.valueOf();\n    const events = [];\n    const eventCount = 10;\n    const step = (to - timeWalker) / eventCount;\n\n    for (let i = 0; i < eventCount; i++) {\n      events.push({\n        annotation: options.annotation,\n        time: timeWalker,\n        text: 'This is the text, <a href=\"https://grafana.com\">Grafana.com</a>',\n        tags: ['text', 'server'],\n      });\n      timeWalker += step;\n    }\n    return Promise.resolve(events);\n  }\n\n  getQueryDisplayText(query: TestDataQuery) {\n    if (query.alias) {\n      return query.scenarioId + ' as ' + query.alias;\n    }\n    return query.scenarioId;\n  }\n\n  testDatasource() {\n    return Promise.resolve({\n      status: 'success',\n      message: 'Data source is working',\n    });\n  }\n\n  getScenarios(): Promise<Scenario[]> {\n    return getBackendSrv().get('/api/tsdb/testdata/scenarios');\n  }\n\n  metricFindQuery(query: string, options: any) {\n    return new Promise<MetricFindValue[]>((resolve, reject) => {\n      setTimeout(() => {\n        const interpolatedQuery = templateSrv.replace(\n          query,\n          getSearchFilterScopedVar({ query, wildcardChar: '*', options })\n        );\n        const children = queryMetricTree(interpolatedQuery);\n        const items = children.map(item => ({ value: item.name, text: item.name }));\n        resolve(items);\n      }, 100);\n    });\n  }\n}\n","import _ from 'lodash';\nimport { dateMath, dateTime } from '@grafana/data';\nimport { e2e } from '@grafana/e2e';\n\nimport { QueryCtrl } from 'app/plugins/sdk';\nimport { defaultQuery } from './runStreams';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { promiseToDigest } from 'app/core/utils/promiseToDigest';\nimport { IScope } from 'angular';\n\nexport const defaultPulse: any = {\n  timeStep: 60,\n  onCount: 3,\n  onValue: 2,\n  offCount: 3,\n  offValue: 1,\n};\n\nexport const defaultCSVWave: any = {\n  timeStep: 60,\n  valuesCSV: '0,0,2,2,1,1',\n};\n\nconst showLabelsFor = ['random_walk', 'predictable_pulse', 'predictable_csv_wave'];\n\nexport class TestDataQueryCtrl extends QueryCtrl {\n  static templateUrl = 'partials/query.editor.html';\n\n  scenarioList: any;\n  scenario: any;\n  newPointValue: number;\n  newPointTime: any;\n  selectedPoint: any;\n  digest: (promise: Promise<any>) => Promise<any>;\n\n  showLabels = false;\n  selectors: typeof e2e.pages.Dashboard.Panels.DataSource.TestData.QueryTab.selectors;\n\n  /** @ngInject */\n  constructor($scope: IScope, $injector: any) {\n    super($scope, $injector);\n\n    this.target.scenarioId = this.target.scenarioId || 'random_walk';\n    this.scenarioList = [];\n    this.newPointTime = dateTime();\n    this.selectedPoint = { text: 'Select point', value: null };\n    this.showLabels = showLabelsFor.includes(this.target.scenarioId);\n    this.selectors = e2e.pages.Dashboard.Panels.DataSource.TestData.QueryTab.selectors;\n  }\n\n  getPoints() {\n    return _.map(this.target.points, (point, index) => {\n      return {\n        text: dateTime(point[1]).format('MMMM Do YYYY, H:mm:ss') + ' : ' + point[0],\n        value: index,\n      };\n    });\n  }\n\n  pointSelected(option: any) {\n    this.selectedPoint = option;\n  }\n\n  deletePoint() {\n    this.target.points.splice(this.selectedPoint.value, 1);\n    this.selectedPoint = { text: 'Select point', value: null };\n    this.refresh();\n  }\n\n  addPoint() {\n    this.target.points = this.target.points || [];\n    this.newPointTime = dateMath.parse(this.newPointTime);\n    this.target.points.push([this.newPointValue, this.newPointTime.valueOf()]);\n    this.target.points = _.sortBy(this.target.points, p => p[1]);\n    this.refresh();\n  }\n\n  $onInit() {\n    return promiseToDigest(this.$scope)(\n      getBackendSrv()\n        .get('/api/tsdb/testdata/scenarios')\n        .then((res: any) => {\n          this.scenarioList = res;\n          this.scenario = _.find(this.scenarioList, { id: this.target.scenarioId });\n        })\n    );\n  }\n\n  scenarioChanged() {\n    this.scenario = _.find(this.scenarioList, { id: this.target.scenarioId });\n    this.target.stringInput = this.scenario.stringInput;\n    this.showLabels = showLabelsFor.includes(this.target.scenarioId);\n\n    if (this.target.scenarioId === 'manual_entry') {\n      this.target.points = this.target.points || [];\n    } else {\n      delete this.target.points;\n    }\n\n    if (this.target.scenarioId === 'streaming_client') {\n      this.target.stream = _.defaults(this.target.stream || {}, defaultQuery);\n    } else {\n      delete this.target.stream;\n    }\n\n    if (this.target.scenarioId === 'predictable_pulse') {\n      this.target.pulseWave = _.defaults(this.target.pulseWave || {}, defaultPulse);\n    } else {\n      delete this.target.pulseWave;\n    }\n\n    if (this.target.scenarioId === 'predictable_csv_wave') {\n      this.target.csvWave = _.defaults(this.target.csvWave || {}, defaultCSVWave);\n    } else {\n      delete this.target.csvWave;\n    }\n\n    this.refresh();\n  }\n\n  streamChanged() {\n    this.refresh();\n  }\n}\n","// Libraries\nimport React, { PureComponent } from 'react';\n\n// Types\nimport { PluginConfigPageProps, DataSourcePluginMeta, DataSourceJsonData } from '@grafana/data';\n\ninterface Props extends PluginConfigPageProps<DataSourcePluginMeta<DataSourceJsonData>> {}\n\nexport class TestInfoTab extends PureComponent<Props> {\n  constructor(props: Props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div>\n        See github for more information about setting up a reproducable test environment.\n        <br />\n        <br />\n        <a\n          className=\"btn btn-inverse\"\n          href=\"https://github.com/grafana/grafana/tree/master/devenv\"\n          target=\"_blank\"\n          rel=\"noopener\"\n        >\n          Github\n        </a>\n        <br />\n      </div>\n    );\n  }\n}\n","// Libraries\nimport React, { PureComponent } from 'react';\n\nimport { DataSourcePluginOptionsEditorProps } from '@grafana/data';\n\ntype Props = DataSourcePluginOptionsEditorProps<any>;\n\n/**\n * Empty Config Editor -- settings to save\n */\nexport class ConfigEditor extends PureComponent<Props> {\n  render() {\n    return <div />;\n  }\n}\n","import { DataSourcePlugin } from '@grafana/data';\nimport { TestDataDataSource } from './datasource';\nimport { TestDataQueryCtrl } from './query_ctrl';\nimport { TestInfoTab } from './TestInfoTab';\nimport { ConfigEditor } from './ConfigEditor';\n\nclass TestDataAnnotationsQueryCtrl {\n  annotation: any;\n  constructor() {}\n  static template = '<h2>Annotation scenario</h2>';\n}\n\nexport const plugin = new DataSourcePlugin(TestDataDataSource)\n  .setConfigEditor(ConfigEditor)\n  .setQueryCtrl(TestDataQueryCtrl)\n  .setAnnotationQueryCtrl(TestDataAnnotationsQueryCtrl)\n  .addConfigPage({\n    title: 'Setup',\n    icon: 'fa fa-list-alt',\n    body: TestInfoTab,\n    id: 'setup',\n  });\n"],"sourceRoot":""}